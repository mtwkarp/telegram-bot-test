(()=>{"use strict";var e={5155:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(4349)),i=a(s(6620)),o=a(s(946)),r=a(s(5164)),u=a(s(9386)),l=a(s(5062)),c=a(s(4288));t.default=class{constructor(e,t){this.privateMessagesTypes=e,this.privateCommands=t}async init(){this.initEnvironmentVariables(),await this.initDatabase(),await this.initGoogleServices(),await this.initBot(),this.initAutoMessenger(),this.initPrivateUpdateSubject(),this.initUserScopeManager(),this.subscribeForPrivateMessagesUpdates()}initAutoMessenger(){(new c.default).initMessengerModules()}async initGoogleServices(){const e=new l.default;await e.authorize()}async initDatabase(){const e=new u.default;await e.init()}async initBot(){this.bot=new i.default,await this.bot.initBot(),await this.bot.launchBot()}initEnvironmentVariables(){n.default.load()}initUserScopeManager(){this.userScopeManager=new o.default}initPrivateUpdateSubject(){this.privateUpdateSubject=new r.default(this.privateMessagesTypes,this.privateCommands),this.privateUpdateSubject.subscribeForBotUpdates(this.bot)}subscribeForPrivateMessagesUpdates(){this.privateUpdateSubject.registerObserver(this.userScopeManager)}}},6620:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(832),n=s(7750);class i extends a.Telegraf{constructor(){super(process.env.TELEGRAM_BOT_TOKEN)}async initBot(){await this.initCommands()}async launchBot(){this.launch()}async initCommands(){const e=[];for(const t in n.commandsDescription)e.push(n.commandsDescription[t]);await this.telegram.setMyCommands(e).then((()=>{console.log("COMMANDS are set successfully")})).catch((e=>{console.error(e)}))}}t.default=i},5402:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(832);t.default=class{constructor(){this.tg=new a.Telegram(process.env.TELEGRAM_BOT_TOKEN)}}},4288:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(4858)),i=a(s(492)),o=a(s(8055));t.default=class{initMessengerModules(){[n.default,i.default,o.default].forEach((e=>{(new e).setScheduledMessages()}))}}},4858:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(8311)),i=a(s(6592));class o extends i.default{constructor(){super()}setScheduledMessages(){const e=this.timeCollection.getScheduleTime("every_day_full_schedule_reminder"),t=this.timeCollection.getTimeConfig("kyiv_time");n.default.schedule(e,this.sendFullNextDaySchedule.bind(this),t)}async sendFullNextDaySchedule(){if(!await this.renderedScheduleSheet.isNextDayWorkable())return;const e=await this.renderedScheduleSheet.getNextDayFullSchedule();let t="";for(let s=0;s<e.length;s++){if(0===e[s].length)continue;const a=e[s][0];let n="\n";s>1&&(n="\n\n"),t=t+n+a}try{await this.tg.sendMessage(process.env.TELEGRAM_CHANNEL_ID,t)}catch(e){console.log("Error on sending everyday schedule to channel",e)}}}t.default=o},492:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(6592)),i=a(s(8311)),o=a(s(9509)),r=a(s(1474));class u extends n.default{constructor(){super(),this.repliesCollection=r.default.getInstance()}setScheduledMessages(){const e=this.timeCollection.getScheduleTime("every_day_teaching_reminder"),t=this.timeCollection.getTimeConfig("kyiv_time");i.default.schedule(e,this.sendTomorrowInstructorsReminders.bind(this),t)}async sendTomorrowInstructorsReminders(){if(!await this.renderedScheduleSheet.isNextDayWorkable())return;const e=await this.renderedScheduleSheet.getTomorrowInstructorsByBase(o.default.nextDayName),t={blood:"–∫—Ä–æ–≤ü©∏",lungs:"–ª–µ–≥–µ–Ω—ñü´Å",heart:"—Å–µ—Ä—Ü–µ‚ù§",evacuation:"–µ–≤–∞–∫—É–∞—Ü—ñ—èüöë"},s={},a={};for(const t in e){const n=e[t];for(let e=0;e<n.length;e++){const{name:i}=n[e];void 0===a[i]&&(a[i]=n[e]),void 0===s[i]&&(s[i]=[]),s[i].push(t)}}for(const e in a){const n=a[e],{chatId:i,name:o}=n;let r=o.split(" ")[1];void 0===r&&(r=o.split(" ")[0]);let u=this.repliesCollection.getScheduleCmdReply("every_day_instructor_reminder"),l="";if(1===s[o].length)u=this.repliesCollection.getScheduleCmdReply("every_day_instructor_reminder"),l=t[s[o][0]];else{u=this.repliesCollection.getScheduleCmdReply("every_day_instructor_reminder_2");for(let e=0;e<s[o].length;e++)l+=`\n- ${t[s[o][e]]}`}u=u.replace("$1",r),u=u.replace("$2",l);try{await this.tg.sendMessage(i,u)}catch(e){console.log(e)}}}}t.default=u},8055:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(6592)),i=a(s(8311)),o=a(s(1474)),r=a(s(4039));class u extends n.default{constructor(){super(),this.repliesCollection=o.default.getInstance(),this.instructorsAvailabilitySheet=new r.default}setScheduledMessages(){this.setPrivateMsgScheduleReminders(),this.setChannelScheduleReminder()}setPrivateMsgScheduleReminders(){const e=this.timeCollection.getScheduleTime("private_msg_schedule_reminder_1"),t=this.timeCollection.getScheduleTime("private_msg_schedule_reminder_2"),s=this.timeCollection.getTimeConfig("kyiv_time");i.default.schedule(e,this.sendScheduleStartPrivateReminders.bind(this),s),i.default.schedule(t,this.sendScheduleStartPrivateReminders.bind(this),s)}setChannelScheduleReminder(){const e=this.timeCollection.getScheduleTime("channel_schedule_reminder_1"),t=this.timeCollection.getScheduleTime("channel_schedule_reminder_2"),s=this.timeCollection.getTimeConfig("kyiv_time");i.default.schedule(e,this.sendFirstScheduleStartReminderToChannel.bind(this),s),i.default.schedule(t,this.sendScheduleStartReminderToChannel.bind(this),s)}async sendScheduleStartPrivateReminders(){const e=await this.instructorsAvailabilitySheet.getInstructorsChatIdsWithNoScheduleResponse();for(let t=0;t<e.length;t++){const{chatId:s,fullName:a}=e[t];let n=a.split(" ")[1];void 0===n&&(n=a.split(" ")[0]);let i=this.repliesCollection.getScheduleCmdReply("private_schedule_reminder");i=i.replace("$1",n);try{await this.tg.sendMessage(s,i)}catch(e){}}}sendScheduleStartReminderToChannel(){this.tg.sendMessage(process.env.TELEGRAM_CHANNEL_ID,this.repliesCollection.getScheduleCmdReply("channel_schedule_reminder"))}async sendFirstScheduleStartReminderToChannel(){await this.instructorsAvailabilitySheet.clearAllPreviousScheduleReplies(),this.sendScheduleStartReminderToChannel()}}t.default=u,e.exports=u},6592:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5402)),i=a(s(4058)),o=a(s(9634));class r extends n.default{constructor(){super(),this.timeCollection=i.default.getInstance(),this.renderedScheduleSheet=new o.default}}t.default=r},5540:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(832),i=s(6604),o=a(s(1820));class r extends o.default{constructor(e,t){super(),this.id=e,this.tg=new n.Telegram(process.env.TELEGRAM_BOT_TOKEN),this._name=t,this.updateTypesImplementations={[i.PRIVATE_UPDATE_TYPES.text]:this.onText.bind(this),[i.PRIVATE_UPDATE_TYPES.callback_query]:this.onCallbackQuery.bind(this),[i.PRIVATE_UPDATE_TYPES.animation]:this.onAnimation.bind(this),[i.PRIVATE_UPDATE_TYPES.audio]:this.onAudio.bind(this),[i.PRIVATE_UPDATE_TYPES.document]:this.onDocument.bind(this),[i.PRIVATE_UPDATE_TYPES.photo]:this.onPhoto.bind(this),[i.PRIVATE_UPDATE_TYPES.sticker]:this.onSticker.bind(this),[i.PRIVATE_UPDATE_TYPES.video]:this.onVideo.bind(this),[i.PRIVATE_UPDATE_TYPES.video_note]:this.onVideoNote.bind(this),[i.PRIVATE_UPDATE_TYPES.voice]:this.onVoice.bind(this),[i.PRIVATE_UPDATE_TYPES.edited_message]:this.onEditedMessage.bind(this),[i.PRIVATE_UPDATE_TYPES.command]:this.onCommand.bind(this)}}get name(){return this._name}async sendMessage(e){await this.tg.sendMessage(this.id.toString(),e)}finishCmd(){}notifyAboutCmdFinish(){this.finishCmd()}onUpdate(e){void 0!==this.updateTypesImplementations[e.updateType]?this.updateTypesImplementations[e.updateType](e):this.updateNotSupported(e.updateType)}updateNotSupported(e){console.log(`Update ${e} not supported`)}onCommand(e){this.noImplementationFound(e)}onCallbackQuery(e){this.noImplementationFound(e)}noImplementationFound(e){console.log(`Update type is ${e.updateType}, but no implementation in current handler (handler name - ${this.name}) found.`)}onText(e){this.noImplementationFound(e)}onAnimation(e){this.noImplementationFound(e)}onAudio(e){this.noImplementationFound(e)}onDocument(e){this.noImplementationFound(e)}onPhoto(e){this.noImplementationFound(e)}onSticker(e){this.noImplementationFound(e)}onVideo(e){this.noImplementationFound(e)}onVideoNote(e){this.noImplementationFound(e)}onVoice(e){this.noImplementationFound(e)}onEditedMessage(e){this.noImplementationFound(e)}}t.default=r},5638:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5502)),i=a(s(2430)),o=s(6604);class r extends n.default{constructor(e,t){super(),this.id=e,this.handlers={},this.defaultHandler=new i.default(this.id),this.setDefaultHandler(),this.initHandlers(t)}initHandlers(e){e.forEach((e=>{const t=new e(this.id);this.handlers[t.name]=t}))}setCurrentHandler(e,t){this.currentHandler=this.handlers[e].copy(),this.currentHandler.onUpdate(t)}setDefaultHandler(){this.currentHandler=this.defaultHandler}onUpdate(e){e.updateType!==o.PRIVATE_UPDATE_TYPES.command?this.currentHandler.onUpdate(e):this.onCommand(e)}onCommand(e){const t=e.payload;void 0!==this.findHandlerByName(t.command)?this.setCurrentHandler(t.command,e):this.noCommandHandlerAvailable()}noCommandHandlerAvailable(){this.currentHandler.finishCmd(),this.setDefaultHandler(),this.defaultHandler.sendNotAvailableCmdMessage()}findHandlerByName(e){return this.handlers[e]}}t.default=r},2885:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5540)),i=a(s(1474)),o=s(9785);class r extends n.default{constructor(e){super(e,o.CMD_NAMES.COMMANDS_INFO)}copy(){return new r(this.id)}onCommand(){const e=i.default.getInstance().getValueFromDocument("commands","commands_description");this.sendMessage(e)}}t.default=r},2430:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5540)),i=s(9785);class o extends n.default{constructor(e){super(e,i.CMD_NAMES.NONE)}copy(){return new o(this.id)}sendNotAvailableCmdMessage(){this.sendMessage("–î–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞—Ä–∞–∑—ñ –≤–∞–º –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –±–æ—Ç–∞.")}}t.default=o},495:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5540)),i=s(9785),o=a(s(7873)),r=s(8399),u=a(s(4039)),l=a(s(4883)),c=a(s(4103)),d=s(2356);class h extends n.default{constructor(e){super(e,i.CMD_NAMES.SCHEDULE),this.markupStatus={},this.markupEditor=new l.default,this.scheduleSheet=new u.default,this.msgResponder=new c.default(e),this.timeAccessController=new o.default,this.timeAccessController.init()}copy(){return new h(this.id)}onCommand(e){this.requestScheduleMarkup(e)}onCallbackQuery(e){this.onButtonClick(e)}requestScheduleMarkup(e){if(!this.timeAccessController.accessible)return void this.msgResponder.notifyUserAboutClosedSchedule();const t=e.payload;this.markupStatus[t.messageId]=d.SCHEDULE_MARKUP_STATUS.active,this.msgResponder.sendDefaultMarkupWithDescription(this.markupEditor.getDefaultMarkup())}async onButtonClick(e){const t=e.payload,s=t.callback_query.data;this.markupStatus[t.messageId]!==d.SCHEDULE_MARKUP_STATUS.sending&&(this.markupStatus[t.messageId]!==d.SCHEDULE_MARKUP_STATUS.unactive?s!==r.confirmScheduleBtnText?(this.markupEditor.handleDayChoiceClick(t),this.markupEditor.checkUpdatedMarkupEquality()||await this.msgResponder.editMarkup(t.messageId,void 0,this.markupEditor.getModifiedMarkup())):await this.confirmSchedule(t.messageId):this.msgResponder.notifyUserAboutUnactiveMarkup())}async confirmSchedule(e){this.timeAccessController.accessible?this.markupEditor.checkIfScheduleFilled()?(this.markupStatus[e]=d.SCHEDULE_MARKUP_STATUS.sending,await this.msgResponder.editMarkup(e,void 0,this.markupEditor.getPendingMarkup()),await this.scheduleSheet.updateUserSchedule(this.id,this.markupEditor.userSchedule).then((()=>{this.msgResponder.sendConfirmedScheduleReply(),this.msgResponder.editMarkup(e,void 0,this.markupEditor.getConfirmedMarkup()),this.markupStatus[e]=d.SCHEDULE_MARKUP_STATUS.unactive})).catch((()=>{this.msgResponder.respondWithUnsuccessfulSpreadsheetInput(),this.markupStatus[e]=d.SCHEDULE_MARKUP_STATUS.unactive}))):this.msgResponder.notifyUserToFillSchedule():this.msgResponder.notifyUserAboutClosedSchedule()}}t.default=h},4103:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2833)),i=a(s(1474)),o=a(s(9982));class r extends n.default{constructor(e){super(e),this.repliesCollection=i.default.getInstance()}async sendDefaultMarkupWithDescription(e){const t=this.repliesCollection.getScheduleCmdReply("schedule_markup_description");this.tg.sendMessage(this.targetId,t,e)}async editMarkup(e,t,s){await this.tg.editMessageReplyMarkup(this.targetId,e,void 0,s.reply_markup)}notifyUserAboutClosedSchedule(){this.sendMessage(this.repliesCollection.getScheduleCmdReply("schedule_closed"))}notifyUserToFillSchedule(){this.sendMessage(this.repliesCollection.getScheduleCmdReply("schedule_must_be_filled_before_sending"))}sendConfirmedScheduleReply(){this.sendMessage(this.repliesCollection.getScheduleCmdReply("confirmed_schedule_reply")),this.tg.sendSticker(this.targetId,o.default.getInstance().getStickerId("maks_tak_trimaty"))}respondWithUnsuccessfulSpreadsheetInput(){this.sendMessage(this.repliesCollection.getScheduleCmdReply("unsuccessful_schedule_input"))}async respondWithWaitForScheduleSending(){return await this.sendMessage(this.repliesCollection.getScheduleCmdReply("schedule_is_being_sent_response"))}notifyUserAboutUnactiveMarkup(){this.sendMessage(this.repliesCollection.getScheduleCmdReply("chosen_schedule_markup_not_active"))}}t.default=r},7873:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2748),i=a(s(4058)),o=a(s(8311)),r=a(s(881));class u extends r.default{constructor(){super(),this.initialized=!1}init(){this.initialized||(this.setAccessibilityStatusOnInit(),this.setAccessibilityModifiers(),this.initialized=!0)}setAccessibilityModifiers(){const e=i.default.getInstance(),t=e.getScheduleTime("open_schedule_time"),s=e.getScheduleTime("close_schedule_time"),a=e.getTimeConfig("kyiv_time");o.default.schedule(t,this.setAccessible.bind(this),a),o.default.schedule(s,this.setUnAccessible.bind(this),a)}setAccessibilityStatusOnInit(){let e=!1;const t=n.DateTime.now();t.setZone("Europe/Kiev");const s=n.DateTime.now();s.setZone("Europe/Kiev");const a=t.minus({days:t.weekday});let i=a.plus({days:4});i=i.set({hour:18,minute:0,second:0});let o=a.plus({days:7});o=o.set({hour:17,minute:0,second:0}),s>=i&&s<=o&&(e=!0),console.log("–ó–∞–ø–∏—Å —É —Ä–æ–∑–∫–ª–∞–¥ "+(e?"–≤—ñ–¥–∫—Ä–∏—Ç–∏–π":"–∑–∞–∫—Ä–∏—Ç–∏–π")),this.accessible=e}}t.default=u},4883:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3453)),i=s(9785),o=s(8399);t.default=class{constructor(){this.markupViewCreator=new n.default,this.setDefaultUserSchedule()}get userSchedule(){return Object.assign({},this._userSchedule)}getDefaultMarkup(){return this.setDefaultUserSchedule(),this.markupViewCreator.getDefaultMarkup(this._userSchedule)}getPendingMarkup(){return this.markupViewCreator.getPendingMarkup(this._userSchedule)}getModifiedMarkup(){return this.markupViewCreator.getDefaultMarkup(this._userSchedule)}checkUpdatedMarkupEquality(){const e=this.markupViewCreator.getDefaultMarkup(this._userSchedule).reply_markup,t=JSON.stringify(e)===JSON.stringify(this.previouslySentMarkup);return this.previouslySentMarkup=this.markupViewCreator.getDefaultMarkup(this._userSchedule).reply_markup,t}handleDayChoiceClick(e){const t=e.callback_query.data;this._userSchedule[t]=!this._userSchedule[t],t===o.notAvailableInstructor?this.clearAllDaysIfInstructorUnavailable():this.makeInstructorAvailable()}clearAllDaysIfInstructorUnavailable(){if(this._userSchedule[o.notAvailableInstructor])for(const e in this._userSchedule)e!==o.notAvailableInstructor&&(this._userSchedule[e]=!1)}makeInstructorAvailable(){this._userSchedule[o.notAvailableInstructor]=!1}getConfirmedMarkup(){return this.markupViewCreator.getDefaultMarkup(this._userSchedule,!0)}checkIfScheduleFilled(){for(const e in this._userSchedule)if(!0===this._userSchedule[e])return!0;return!1}setDefaultUserSchedule(){this._userSchedule={[i.DayNames.monday]:!1,[i.DayNames.tuesday]:!1,[i.DayNames.wednesday]:!1,[i.DayNames.thursday]:!1,[i.DayNames.friday]:!1,[i.DayNames.saturday]:!1,[i.DayNames.sunday]:!1,[o.notAvailableInstructor]:!1}}}},3453:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(8399),n=s(9785),i=s(832),o={[n.DayNames.monday]:"–ü–ù",[n.DayNames.tuesday]:"–í–¢",[n.DayNames.wednesday]:"–°–†",[n.DayNames.thursday]:"–ß–¢",[n.DayNames.friday]:"–ü–¢",[n.DayNames.saturday]:"–°–ë",[n.DayNames.sunday]:"–ù–î"};t.default=class{getDefaultMarkup(e,t=!1){const s=this.getMarkup(e);return s.push([this.getConfirmButtonMarkup(t)]),i.Markup.inlineKeyboard(s)}getMarkup(e){const{monday:t,tuesday:s,wednesday:i,thursday:o,friday:r,saturday:u,sunday:l}=n.DayNames;return[[this.getChosenDayBtnMarkup(t,t,e[t]),this.getChosenDayBtnMarkup(s,s,e[s]),this.getChosenDayBtnMarkup(i,i,e[i])],[this.getChosenDayBtnMarkup(o,o,e[o]),this.getChosenDayBtnMarkup(r,r,e[r]),this.getChosenDayBtnMarkup(u,u,e[u])],[this.getChosenDayBtnMarkup(l,l,e[l]),this.getBtnMarkup(a.notAvailableInstructor,a.notAvailableInstructor,e[a.notAvailableInstructor])]]}getPendingMarkup(e){const t=this.getMarkup(e);return t.push([this.getPendingConfirmButtonMarkup()]),i.Markup.inlineKeyboard(t)}getConfirmButtonMarkup(e=!1){return{text:a.confirmScheduleBtnText+(e?"üî•":" ‚û°"),callback_data:a.confirmScheduleBtnText}}getPendingConfirmButtonMarkup(){return{text:a.confirmScheduleBtnText+"...",callback_data:a.confirmScheduleBtnText}}getBtnMarkup(e,t,s=!1){return{text:e+(s?" ‚úÖ":""),callback_data:t}}getChosenDayBtnMarkup(e,t,s=!1){let a=e;return void 0!==o[e]&&(a=o[e]),this.getBtnMarkup(a,t,s)}}},8399:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.noResponseInstructorsColumn=t.numberOfRowsInRenderedSchedule=t.fullScheduleByDayLetters=t.baseInstructorsByLetters=t.confirmScheduleBtnText=t.notAvailableInstructor=t.dayNamesByCellsLettersInSheet=void 0;const a=s(9785),n="–í—ñ–¥—Å—É—Ç–Ω—ñ–π(–Ω—è)";t.notAvailableInstructor=n,t.noResponseInstructorsColumn="M",t.confirmScheduleBtnText="–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò";const i={[a.DayNames.monday]:"C",[a.DayNames.tuesday]:"D",[a.DayNames.wednesday]:"E",[a.DayNames.thursday]:"F",[a.DayNames.friday]:"G",[a.DayNames.saturday]:"H",[a.DayNames.sunday]:"I",[n]:"J"};t.dayNamesByCellsLettersInSheet=i,t.baseInstructorsByLetters={Monday:{blood:"A",lungs:"B",heart:"C",evacuation:"D"},Tuesday:{blood:"F",lungs:"G",heart:"H",evacuation:"I"},Wednesday:{blood:"K",lungs:"L",heart:"M",evacuation:"N"},Thursday:{blood:"P",lungs:"Q",heart:"R",evacuation:"S"},Friday:{blood:"U",lungs:"V",heart:"W",evacuation:"X"},Saturday:{blood:"Z",lungs:"AA",heart:"AB",evacuation:"AC"},Sunday:{blood:"AE",lungs:"AF",heart:"AG",evacuation:"AH"}},t.fullScheduleByDayLetters={Monday:"A",Tuesday:"B",Wednesday:"C",Thursday:"D",Friday:"E",Saturday:"F",Sunday:"G"},t.numberOfRowsInRenderedSchedule=14},2356:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.SCHEDULE_MARKUP_STATUS=void 0,(s=t.SCHEDULE_MARKUP_STATUS||(t.SCHEDULE_MARKUP_STATUS={})).unactive="unactive",s.sending="sending",s.active="active"},8245:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5540)),i=s(9785),o=a(s(1474));class r extends n.default{constructor(e){super(e,i.CMD_NAMES.START)}copy(){return new r(this.id)}onCommand(){const e=o.default.getInstance().getValueFromDocument("start","bot_introduction");this.sendMessage(e)}}t.default=r},9386:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(4058)),i=a(s(760)),o=a(s(1474)),r=a(s(2187)),u=a(s(694)),l=a(s(9982));t.default=class{async init(){await this.initDataBase(),await this.initCollectionManagers()}async initCollectionManagers(){const e=[n.default.getInstance(),o.default.getInstance(),r.default.getInstance(),u.default.getInstance(),l.default.getInstance()];for(let t=0;t<e.length;t++){const s=e[t];await s.init()}}async initDataBase(){const e=new i.default;await e.initDataBase()}}},6907:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.data={}}}},760:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(6907)),i=s(325),o=a(s(8971)),r=s(2594);class u extends n.default{constructor(){super()}get allRemoteData(){return this.data}async initDataBase(){await this.initApp(),await this.loadRemoteData()}async loadRemoteData(){const e=(0,r.getFirestore)(),t=await e.listCollections();for(let e=0;e<t.length;e++){const s=t[e],a=await s.listDocuments(),n={};for(let e=0;e<a.length;e++){const t=a[e],i=await t.get(),o=await i.data();void 0!==o&&(n[i.id]=o,this.setActionOnDocumentSnapshotOnAppLoad({collection:s,document:t}))}this.data[s.id]=n}}async initApp(){await(0,i.initializeApp)({credential:(0,i.cert)(o.default.serviceAccountCredentials)})}setActionOnDocumentSnapshotOnAppLoad({collection:e,document:t}){let s=!1;t.onSnapshot((async a=>{if(s){const s=await a.data(),n=e.id;if(this.data[n]){const e=this.data[n];void 0!==s&&(e[t.id]=s)}}s=!0}),(e=>{console.log(`Encountered error: ${e}`)}))}}t.default=u},3155:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(9679));t.default=class{constructor(e){this.collectionName=e,this.collection={},this.initialized=!1}async init(){if(this.initialized)return;const e=new n.default(this.collection,this.collectionName);await e.setUpdates(),this.initialized=!0}getValueFromDocument(e,t){const s=this.getDocument(e);if(void 0!==s)return this.getValue(s,t)}getAllDocumentValues(e){return Object.assign({},this.collection[e])}getValue(e,t){let s=e[t];return"string"==typeof s&&(s=s.replaceAll("<br />","\n")),s}getDocument(e){return this.collection[e]}}},9679:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(2594);t.default=class{constructor(e,t){this.collection=e,this.collectionName=t}async setUpdates(){const e=(0,a.getFirestore)(),t=await e.collection(this.collectionName),s=await t.listDocuments();for(let e=0;e<s.length;e++){const t=s[e];await this.setUpdateHook(t)}}async setUpdateHook(e){await new Promise((t=>{e.onSnapshot((async e=>{const s=await this.updateCollection(e);t(s)}))}))}async updateCollection(e){const t=await e.data();void 0!==t&&(this.collection[e.id]=t)}}},1474:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3155));class i extends n.default{constructor(){super("reply_messages")}getScheduleCmdReply(e){return this.getValueFromDocument("schedule",e)}static getInstance(){if(null===i.uniqueInstance){const e=new i;return i.uniqueInstance=e,e}return i.uniqueInstance}}t.default=i,i.uniqueInstance=null},2187:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3155));class i extends n.default{constructor(){super("google_sheets")}getSheetName(e){return this.getValueFromDocument("schedule_sheets_names",e)}static getInstance(){if(null===i.uniqueInstance){const e=new i;return i.uniqueInstance=e,e}return i.uniqueInstance}}t.default=i,i.uniqueInstance=null},9982:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3155));class i extends n.default{constructor(){super("stickers")}getStickerId(e){return this.getValueFromDocument("sticker_strings",e)}static getInstance(){if(null===i.uniqueInstance){const e=new i;return i.uniqueInstance=e,e}return i.uniqueInstance}}t.default=i,i.uniqueInstance=null},4058:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3155));class i extends n.default{constructor(){super("time_values")}getScheduleTime(e){return this.getValueFromDocument("schedule",e)}getTimeConfig(e){return this.getValueFromDocument("time_configs",e)}static getInstance(){if(null===i.uniqueInstance){const e=new i;return i.uniqueInstance=e,e}return i.uniqueInstance}}t.default=i,i.uniqueInstance=null},694:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3155));class i extends n.default{constructor(){super("users")}getUserName(e){return this.getValueFromDocument("names",e)}getUserFullName(e){return this.getValueFromDocument("fullNames",e)}static getInstance(){if(null===i.uniqueInstance){const e=new i;return i.uniqueInstance=e,e}return i.uniqueInstance}}t.default=i,i.uniqueInstance=null},4349:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5142));t.default=class{static load(){n.default.config();const{mode:e}=process.env;"development"!==e&&"test"!==e||this.loadDevEnvVariables(),"production"===e&&this.loadProdEnvVariables()}static loadDevEnvVariables(){process.env.TELEGRAM_BOT_TOKEN=process.env.TELEGRAM_BOT_TOKEN_DEVELOPMENT,process.env.TELEGRAM_CHANNEL_ID=process.env.TELEGRAM_CHANNEL_ID_DEVELOPMENT,process.env.SCHEDULE_SPREADSHEET_ID=process.env.SCHEDULE_SPREADSHEET_ID_DEVELOPMENT}static loadProdEnvVariables(){process.env.TELEGRAM_BOT_TOKEN=process.env.TELEGRAM_BOT_TOKEN_PRODUCTION,process.env.TELEGRAM_CHANNEL_ID=process.env.TELEGRAM_CHANNEL_ID_PRODUCTION,process.env.SCHEDULE_SPREADSHEET_ID=process.env.SCHEDULE_SPREADSHEET_ID_PRODUCTION}}},5062:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(6781),i=a(s(8971));class o{constructor(){if(null!==o.instance)return o.instance;o.instance=this}async authorize(){o.authObj||(o.authObj=await new n.GoogleAuth({credentials:i.default.serviceAccountCredentials,scopes:["https://www.googleapis.com/auth/spreadsheets"]}))}static get authenticationObject(){return o.authObj}}t.default=o,o.instance=null},2291:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(9326)),i=a(s(2187));class o extends n.default{constructor(){super(process.env.SCHEDULE_SPREADSHEET_ID),this.sheetCollection=i.default.getInstance()}}t.default=o},4039:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2291)),i=s(8399),o=a(s(694)),r=s(9785);class u extends n.default{constructor(){super(),this.usersCollection=o.default.getInstance()}async clearAllPreviousScheduleReplies(){const e=i.dayNamesByCellsLettersInSheet[r.DayNames.monday],t=i.dayNamesByCellsLettersInSheet[i.notAvailableInstructor],s=this.sheetCollection.getSheetName("instructors_availability"),a=`${s}!${e}2:${t}`,n=await this.getSheetValues({range:a});for(let e=0;e<n.length;e++){const t=n[e];for(let e=0;e<t.length;e++)t[e]="FALSE"}const o=`${s}!${e}2:${t}${n.length+1}`;await this.updateSheetValues({range:o,values:n,majorDimension:"ROWS"})}async updateUserSchedule(e,t){const s=this.usersCollection.getUserFullName(e.toString());console.log(s);const a=await this.getUserRowIndexInAvailabilitySheet(s);null!==a?(await this.clearPreviousSchedule(a),await this.setScheduleInSpreadsheet(a,t)):console.log("No such instructor in availability sheet !")}async getUserRowIndexInAvailabilitySheet(e){const t=`${this.sheetCollection.getSheetName("instructors_availability")}!A:A`,s=await this.getSheetValues({range:t});let a=null;for(let t=0;t<s.length;t++)if(e===s[t][0]){a=t+1;break}return a}async setScheduleInSpreadsheet(e,t){const s=i.dayNamesByCellsLettersInSheet[r.DayNames.monday]+e,a=i.dayNamesByCellsLettersInSheet[i.notAvailableInstructor]+e,n=`${this.sheetCollection.getSheetName("instructors_availability")}!${s}:${a}`,o=[t[r.DayNames.monday],t[r.DayNames.tuesday],t[r.DayNames.wednesday],t[r.DayNames.thursday],t[r.DayNames.friday],t[r.DayNames.saturday],t[r.DayNames.sunday],t[i.notAvailableInstructor]].map((e=>[e.toString().toUpperCase()]));try{await this.updateSheetValues({values:o,range:n}).then((()=>{console.log("Schedule was successfully sent !")}))}catch(e){throw console.log("Schedule sending is unsuccessfull, abort !"),e}}async clearPreviousSchedule(e){const t=i.dayNamesByCellsLettersInSheet[r.DayNames.monday]+e,s=i.dayNamesByCellsLettersInSheet[i.notAvailableInstructor]+e,a=`${this.sheetCollection.getSheetName("instructors_availability")}!${t}:${s}`,n=[["FALSE"],["FALSE"],["FALSE"],["FALSE"],["FALSE"],["FALSE"],["FALSE"],["FALSE"]];try{await this.updateSheetValues({range:a,values:n})}catch(e){throw console.log("Schedule cleaning is unsuccessfull !"),e}}async getInstructorsChatIdsWithNoScheduleResponse(){const e=(await this.getSheetValues({range:`${this.sheetCollection.getSheetName("instructors_availability")}!${i.noResponseInstructorsColumn}2:${i.noResponseInstructorsColumn}1000`})).flat(),t=await this.usersCollection.getAllDocumentValues("fullNames"),s=[];for(let a=0;a<e.length;a++){const n=e[a];for(const e in t){const a=t[e];a===n&&s.push({fullName:a,chatId:Number(e)})}}return s}}t.default=u},9634:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2291)),i=s(8399),o=a(s(9509));class r extends n.default{constructor(){super()}async getNextDayFullSchedule(){const e=i.fullScheduleByDayLetters[o.default.nextDayName],t=`${this.sheetCollection.getSheetName("schedule_rendered")}!${e}3:${e}100`;return await this.getSheetValues({range:t})}async isNextDayWorkable(){const e=i.fullScheduleByDayLetters[o.default.nextDayName];return"FALSE"!==(await this.getSheetValues({range:`${this.sheetCollection.getSheetName("schedule_rendered")}!${e}2`}))[0][0]}async getInstructorsIdsByNames(e=[]){const t=await this.getSheetValues({range:`${this.sheetCollection.getSheetName("instructors_list")}!$A:D`}),s=[];for(let a=0;a<e.length;a++){const n=e[a];for(let e=0;e<t.length;e++){const a=t[e][0];if(a===n){const n=t[e][2];s.push({name:a,chatId:n})}}}return s}async getTomorrowInstructorsByBase(e){console.log(e);const t=i.baseInstructorsByLetters[e],s={blood:[],lungs:[],heart:[],evacuation:[]},a={0:"blood",1:"lungs",2:"heart",3:"evacuation"},n=await this.getSheetValues({range:`${this.sheetCollection.getSheetName("instructors_by_bases_schedule")}!${t.blood}3:${t.evacuation}100`}),o=[];for(let e=0;e<n.length;e++){const t=n[e];for(let e=0;e<t.length;e++){const n=t[e];""!==n&&"#N/A"!==n&&(o.includes(n)||o.push(n),s[a[e]].push(n))}}const r=await this.getInstructorsIdsByNames(o),u={blood:[],lungs:[],heart:[],evacuation:[]};for(const e in s)for(let t=0;t<s[e].length;t++){const a=s[e][t];for(let t=0;t<r.length;t++){const s=r[t];a===s.name&&u[e].push(s)}}return u}}t.default=r},9326:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(9993),i=a(s(5062));t.default=class{constructor(e){this.spreadsheetId=e,this.spreadsheet=n.google.sheets({version:"v4",auth:i.default.authenticationObject}),this.values=this.spreadsheet.spreadsheets.values}async getSheetValues({range:e}){const t=(await this.values.get({spreadsheetId:this.spreadsheetId,range:e})).data.values;return null==t?(console.log("No value found in sheets"),[[]]):t}async updateSheetValues(e){const t=e.valueInputOption||"USER_ENTERED",s=e.majorDimension||"COLUMNS";return await this.values.update({spreadsheetId:this.spreadsheetId,range:e.range,valueInputOption:t,requestBody:{range:e.range,majorDimension:s,values:e.values}})}}},9509:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(9785);class n{static get dayNames(){return[a.DayNames.sunday,a.DayNames.monday,a.DayNames.tuesday,a.DayNames.wednesday,a.DayNames.thursday,a.DayNames.friday,a.DayNames.saturday]}static get nextDayName(){let e=(new Date).getDay()+1;return e>6&&(e=0),n.dayNames[e]}static get currentDayName(){return n.dayNames[(new Date).getDay()]}}t.default=n},8971:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{static get serviceAccountCredentials(){const e=process.env.SERVICE_ACCOUNT_PRIVATE_KEY.replaceAll("\\n","\n");return{type:process.env.SERVICE_ACCOUNT_TYPE,project_id:process.env.SERVICE_ACCOUNT_PROJECT_ID,private_key_id:process.env.SERVICE_ACCOUNT_PRIVATE_KEY_ID,private_key:e,client_email:process.env.SERVICE_ACCOUNT_CLIENT_EMAIL,client_id:process.env.SERVICE_ACCOUNT_CLIENT_ID,auth_uri:process.env.SERVICE_ACCOUNT_AUTH_URI,token_uri:process.env.SERVICE_ACCOUNT_TOKEN_URI,auth_provider_x509_cert_url:process.env.SERVICE_ACCOUNT_AUTH_PROVIDER_CERT_URL,client_x509_cert_url:process.env.SERVICE_ACCOUNT_CLIENT_CERT_URL}}}},341:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5155)),i=s(6604),o=s(9785),{text:r,callback_query:u,command:l,animation:c,audio:d,document:h,photo:_,sticker:p,video:m,video_note:f,voice:y,edited_message:g,location:S}=i.PRIVATE_UPDATE_TYPES,v=[r,u,l,c,d,h,_,p,m,f,y,g,S],E=[o.CMD_NAMES.SCHEDULE,o.CMD_NAMES.COMMANDS_INFO,o.CMD_NAMES.START];new n.default(v,E).init().then((()=>{console.log("Successful APPLICATION start")})).catch((e=>{console.log(e)}))},2833:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(832);t.default=class{constructor(e){this.tg=new a.Telegram(process.env.TELEGRAM_BOT_TOKEN),this.targetId=e}async sendMessage(e){return await this.tg.sendMessage(this.targetId,e)}}},7750:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.commandsDescription=void 0;const a=s(9785),n={schedule:{command:a.CMD_NAMES.SCHEDULE,description:"–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ä–æ–∑–∫–ª–∞–¥."},info:{command:a.CMD_NAMES.COMMANDS_INFO,description:"–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø–æ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∫–æ–º–∞–Ω–¥–∞—Ö –±–æ—Ç–∞."},start:{command:a.CMD_NAMES.START,description:"–°—Ç–∞—Ä—Ç —Ä–æ–±–æ—Ç–∏ –∑ –±–æ—Ç–æ–º."}};t.commandsDescription=n},5164:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(6604),i=a(s(9438)),o=a(s(1295));class r extends i.default{constructor(e,t){super(e),this.receiveCommands=t,this.contextDecoratorCreator=new o.default}subscribeForBotUpdates(e){this.subscribeForCommands(e),this.subscribeForMessages(e)}subscribeForCommands(e){this.receiveCommands.forEach((t=>{e.command(t,(e=>{this.onUpdate(n.PRIVATE_UPDATE_TYPES.command,e)}))}))}onUpdate(e,t){if("private"!==t.chat?.type)return;const s=this.contextDecoratorCreator.createDecorator(e,t);null!==s&&this.notifyObservers(s)}}t.default=r},9438:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2998));class i extends n.default{constructor(e){super(),this.receiveMessagesTypes=e}subscribeForBotUpdates(e){this.subscribeForMessages(e)}subscribeForMessages(e){this.receiveMessagesTypes.forEach((t=>{"command"!==t&&e.on(t,(e=>{this.onUpdate(t,e)}))}))}}t.default=i},5959:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{}},1295:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5959)),i=s(4317),o=a(s(873));class r extends n.default{constructor(){super(...arguments),this.updateScope=i.UPDATE_SCOPES.PRIVATE,this.payloadCreator=new o.default}createDecorator(e,t){const s=this.payloadCreator.create(e,t);return null===s?null:{payload:s,messagePayloadType:s.type,updateType:e,updateScope:this.updateScope,context:t}}}t.default=r},7838:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(6604);t.default=class{static getMessageField(e){return e.update.message}static getUpdateMessageType(e){for(const t in a.MESSAGES_TYPES)if(Object.prototype.hasOwnProperty.call(e,t))return t;return a.MESSAGES_TYPES.none}static getContextUpdateType(e){for(const t in a.UPDATE_TYPES)if(Object.prototype.hasOwnProperty.call(e,t))return t;return a.UPDATE_TYPES.unknown}}},2998:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.observers=[]}registerObserver(e){this.observers.includes(e)?console.warn("This observer already registered"):this.observers.push(e)}removeObserver(e){this.observers.includes(e)?this.observers.splice(this.observers.indexOf(e),1):console.warn("No such observer you are trying to delete")}notifyObservers(e){this.observers.forEach((t=>{t.onUpdate(e)}))}}},873:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(6604),i=s(2496),o=a(s(7838)),r=a(s(1820));class u extends r.default{constructor(){super(...arguments),this.decoratorCreatorFunctionByUpdateType={[n.PRIVATE_UPDATE_TYPES.text]:this.onText.bind(this),[n.PRIVATE_UPDATE_TYPES.callback_query]:this.onCallbackQuery.bind(this),[n.PRIVATE_UPDATE_TYPES.command]:this.onCommand.bind(this),[n.PRIVATE_UPDATE_TYPES.animation]:this.onAnimation.bind(this),[n.PRIVATE_UPDATE_TYPES.audio]:this.onAudio.bind(this),[n.PRIVATE_UPDATE_TYPES.document]:this.onDocument.bind(this),[n.PRIVATE_UPDATE_TYPES.photo]:this.onPhoto.bind(this),[n.PRIVATE_UPDATE_TYPES.sticker]:this.onSticker.bind(this),[n.PRIVATE_UPDATE_TYPES.video]:this.onVideo.bind(this),[n.PRIVATE_UPDATE_TYPES.video_note]:this.onVideoNote.bind(this),[n.PRIVATE_UPDATE_TYPES.voice]:this.onVoice.bind(this),[n.PRIVATE_UPDATE_TYPES.edited_message]:this.onEditedMessage.bind(this),[n.PRIVATE_UPDATE_TYPES.location]:this.onLocation.bind(this)}}create(e,t){const s=this.decoratorCreatorFunctionByUpdateType[e];return void 0===s?(console.log(`Creation of this kind of payload (${e}) not yet supported`),null):s(t)||null}getDefaultMediaValuesFromMsg(e){return{caption:e.caption,caption_entities:e.caption_entities,media_group_id:e.media_group_id}}getDefaultPayload(e,t,s){const a=o.default.getContextUpdateType(e.update);let i=n.MESSAGES_TYPES.none;if(a===n.UPDATE_TYPES.unknown)throw new Error("UPDATE TYPE UNKNOWN !!!");return a===n.UPDATE_TYPES.message&&(i=o.default.getUpdateMessageType(e.message)),{senderId:s.id,chatId:s.id,updateType:a,messageType:i,type:t}}onText(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,i.PAYLOAD_TYPES.text,t.from),text:t.text,entities:t.entities}}onCallbackQuery(e){const t=e.update,s=this.getDefaultPayload(e,i.PAYLOAD_TYPES.callback_query,t.callback_query.from),a=t.callback_query.message;return{...s,callback_query:t.callback_query,messageId:a.message_id}}onCommand(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,i.PAYLOAD_TYPES.command,t.from),command:t.text.slice(1)}}onAnimation(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,i.PAYLOAD_TYPES.animation,t.from),animation:t.animation,document:t.document}}onAudio(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,i.PAYLOAD_TYPES.audio,t.from),audio:t.audio,...this.getDefaultMediaValuesFromMsg(t)}}onDocument(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,i.PAYLOAD_TYPES.document,t.from),document:t.document,...this.getDefaultMediaValuesFromMsg(t)}}onPhoto(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,i.PAYLOAD_TYPES.photo,t.from),photo:t.photo,...this.getDefaultMediaValuesFromMsg(t)}}onSticker(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,i.PAYLOAD_TYPES.sticker,t.from),sticker:t.sticker}}onVideo(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,i.PAYLOAD_TYPES.video,t.from),video:t.video,...this.getDefaultMediaValuesFromMsg(t)}}onVideoNote(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,i.PAYLOAD_TYPES.video_note,t.from),video_note:t.video_note}}onVoice(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,i.PAYLOAD_TYPES.voice,t.from),voice:t.voice,caption:t.caption}}onEditedMessage(e){const t=e.update;return{...this.getDefaultPayload(e,i.PAYLOAD_TYPES.edited_message,t.edited_message.from),edited_message:t,edited_message_type:o.default.getUpdateMessageType(t.edited_message)}}onLocation(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,i.PAYLOAD_TYPES.voice,t.from),location:t.location}}}t.default=u},1820:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{onText(e){}onCallbackQuery(e){}onCommand(e){}onAnimation(e){}onAudio(e){}onDocument(e){}onPhoto(e){}onSticker(e){}onVideo(e){}onVideoNote(e){}onVoice(e){}onEditedMessage(e){}onLocation(e){}}},4317:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.UPDATE_SCOPES=void 0,function(e){e.CHANNEL="channel_scope",e.CHAT="chat_scope",e.PRIVATE="private_scope"}(s||(s={})),t.UPDATE_SCOPES=s},6604:(e,t)=>{var s,a,n,i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.UPDATE_TYPES=t.MESSAGES_TYPES=t.CHAT_UPDATE_TYPES=t.CHANNEL_UPDATE_TYPES=t.PRIVATE_UPDATE_TYPES=void 0,function(e){e.text="text",e.audio="audio",e.document="document",e.animation="animation",e.photo="photo",e.sticker="sticker",e.video="video",e.video_note="video_note",e.voice="voice",e.contact="contact",e.dice="dice",e.game="game",e.poll="poll",e.location="location",e.venue="venue",e.new_chat_members="new_chat_members",e.left_chat_member="left_chat_member",e.new_chat_title="new_chat_title",e.new_chat_photo="new_chat_photo",e.delete_chat_photo="delete_chat_photo",e.group_chat_created="group_chat_created",e.supergroup_chat_created="supergroup_chat_created",e.channel_chat_created="channel_chat_created",e.message_auto_delete_timer_changed="message_auto_delete_timer_changed",e.migrate_to_chat_id="migrate_to_chat_id",e.migrate_from_chat_id="migrate_from_chat_id",e.pinned_message="pinned_message",e.invoice="invoice",e.successful_payment="successful_payment",e.connected_website="connected_website",e.passport_data="passport_data",e.proximity_alert_triggered="proximity_alert_triggered",e.forum_topic_created="forum_topic_created",e.forum_topic_closed="forum_topic_closed",e.forum_topic_reopened="forum_topic_reopened",e.video_chat_scheduled="video_chat_scheduled",e.video_chat_started="video_chat_started",e.video_chat_ended="video_chat_ended",e.video_chat_participants_invited="video_chat_participants_invited",e.web_app_data="web_app_data",e.none="none"}(s||(s={})),t.MESSAGES_TYPES=s,function(e){e.message="message",e.edited_message="edited_message",e.channel_post="channel_post",e.edited_channel_post="edited_channel_post",e.inline_query="inline_query",e.chosen_inline_result="chosen_inline_result",e.callback_query="callback_query",e.shipping_query="shipping_query",e.pre_checkout_query="pre_checkout_query",e.poll="poll",e.poll_answer="poll_answer",e.my_chat_member="my_chat_member",e.chat_member="chat_member",e.chat_join_request="chat_join_request",e.unknown="unknown"}(a||(a={})),t.UPDATE_TYPES=a,function(e){e.text="text",e.callback_query="callback_query",e.command="command",e.animation="animation",e.audio="audio",e.document="document",e.photo="photo",e.sticker="sticker",e.video="video",e.video_note="video_note",e.voice="voice",e.edited_message="edited_message",e.location="location"}(n||(n={})),t.PRIVATE_UPDATE_TYPES=n,function(e){e.channel_post="channel_post"}(i||(i={})),t.CHANNEL_UPDATE_TYPES=i,function(e){e.new_chat_photo="new_chat_photo",e.command="command"}(o||(o={})),t.CHAT_UPDATE_TYPES=o},2496:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.PAYLOAD_TYPES=void 0,(s=t.PAYLOAD_TYPES||(t.PAYLOAD_TYPES={})).audio="audio_payload_type",s.text="text_payload_type",s.callback_query="callback_query_payload_type",s.command="command_type",s.animation="animation_type",s.document="document_type",s.photo="photo_type",s.sticker="sticker_type",s.video="video_type",s.video_note="video_note_type",s.voice="voice_type",s.edited_message="edited_message_type"},881:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this._accessible=!1}setUnAccessible(){this.accessible=!1}setAccessible(){this.accessible=!0}get accessible(){return this._accessible}set accessible(e){this._accessible=e}}},9785:(e,t)=>{var s,a;Object.defineProperty(t,"__esModule",{value:!0}),t.DayNames=t.CMD_NAMES=void 0,(a=t.CMD_NAMES||(t.CMD_NAMES={})).SCHEDULE="schedule",a.COMMANDS_INFO="commandsinfo",a.NONE="none",a.START="start",(s=t.DayNames||(t.DayNames={})).sunday="Sunday",s.monday="Monday",s.tuesday="Tuesday",s.wednesday="Wednesday",s.thursday="Thursday",s.friday="Friday",s.saturday="Saturday"},946:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(7358));t.default=class{constructor(){this.users={}}getUserById(e){let t=this.users[e];return void 0===t&&(t=this.createUserScope(e)),t}createUserScope(e){const t=new n.default(e);return this.users[e]=t,t}onUpdate(e){this.getUserById(e.payload.senderId).onUpdate(e)}}},7358:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(9119));t.default=class{constructor(e){this.id=e,this.strategy=new n.default(e)}onUpdate(e){this.strategy.onUpdate(e)}}},9119:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(6481)),i=a(s(5638)),o=a(s(495)),r=a(s(2885)),u=a(s(8245));class l extends n.default{constructor(e){super(),this.cmdHandlerManager=new i.default(e,[o.default,r.default,u.default])}onUpdate(e){this.cmdHandlerManager.onUpdate(e)}}t.default=l},6481:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{}},5142:e=>{e.exports=require("dotenv")},5502:e=>{e.exports=require("eventemitter3")},325:e=>{e.exports=require("firebase-admin/app")},2594:e=>{e.exports=require("firebase-admin/firestore")},6781:e=>{e.exports=require("google-auth-library")},9993:e=>{e.exports=require("googleapis")},2748:e=>{e.exports=require("luxon")},8311:e=>{e.exports=require("node-cron")},832:e=>{e.exports=require("telegraf")}},t={};!function s(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,s),i.exports}(341)})();