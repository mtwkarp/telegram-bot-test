(()=>{"use strict";var e={5155:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(4349)),r=a(s(6620)),o=a(s(946)),i=a(s(5164)),u=a(s(9386)),l=a(s(5062)),d=a(s(4288)),c=a(s(3301)),h=a(s(7474)),_=a(s(6438));t.default=class{constructor(e,t){this.privateMessagesTypes=e,this.privateCommands=t,this.spreadsheetRequestSubject=new h.default,this.expressServer=new c.default,this.requestHandlersManager=new _.default}async init(){this.initEnvironmentVariables(),await this.initDatabase(),await this.initGoogleServices(),await this.initBot(),this.initAutoMessenger(),this.initPrivateUpdateSubject(),this.initUserScopeManager(),this.subscribeForPrivateMessagesUpdates(),this.subscribeSpreadsheetRequestSubjectForServerUpdates(),this.subscribeRequestHandlers()}subscribeRequestHandlers(){this.requestHandlersManager.initSpreadsheetRequestHandlers(this.spreadsheetRequestSubject)}subscribeSpreadsheetRequestSubjectForServerUpdates(){this.expressServer.subscribeSpreadSheetRequestSubject(this.spreadsheetRequestSubject)}initAutoMessenger(){(new d.default).initMessengerModules()}async initGoogleServices(){const e=new l.default;await e.authorize()}async initDatabase(){const e=new u.default;await e.init()}async initBot(){this.bot=new r.default,await this.bot.initBot(),await this.bot.launchBot()}initEnvironmentVariables(){n.default.load()}initUserScopeManager(){this.userScopeManager=new o.default}initPrivateUpdateSubject(){this.privateUpdateSubject=new i.default(this.privateMessagesTypes,this.privateCommands),this.privateUpdateSubject.subscribeForBotUpdates(this.bot)}subscribeForPrivateMessagesUpdates(){this.privateUpdateSubject.registerObserver(this.userScopeManager)}}},6620:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(832),n=s(7750);class r extends a.Telegraf{constructor(){super(process.env.TELEGRAM_BOT_TOKEN)}async initBot(){await this.initCommands()}async launchBot(){this.launch()}async initCommands(){const e=[];for(const t in n.commandsDescription)e.push(n.commandsDescription[t]);await this.telegram.setMyCommands(e).then((()=>{console.log("COMMANDS are set successfully")})).catch((e=>{console.error(e)}))}}t.default=r},5402:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(832);t.default=class{constructor(){this.tg=new a.Telegram(process.env.TELEGRAM_BOT_TOKEN)}}},4288:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(6024)),r=a(s(4910)),o=a(s(8274)),i=a(s(9280)),u=a(s(1306)),l=a(s(561)),d=a(s(4705));t.default=class{initMessengerModules(){[n.default,r.default,o.default,i.default,u.default,l.default,d.default].forEach((e=>{(new e).setScheduledMessages()}))}}},561:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2773)),r=a(s(8311)),o=a(s(4039)),i=a(s(2447)),u=a(s(2232));class l extends n.default{constructor(){super(),this.instructorsAvailabilitySheet=new o.default}setScheduledMessages(){const e=this.timeCollection.getScheduleTime("channel_schedule_reminder_1"),t=this.timeCollection.getScheduleTime("clear_rendered_schedule_sheets_time"),s=this.timeCollection.getTimeConfig("kyiv_time");r.default.schedule(e,this.clearAllPreviousScheduleReplies.bind(this),s),r.default.schedule(t,this.clearRenderedScheduleSheetTrips.bind(this),s)}async clearRenderedScheduleSheetTrips(){const e=new u.default,t=new i.default;await t.setAllDaysUnworkable(),await e.setAllDaysUnworkable()}async clearAllPreviousScheduleReplies(){await this.instructorsAvailabilitySheet.clearAllPreviousScheduleReplies()}}t.default=l,e.exports=l},8274:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2773)),r=a(s(8311)),o=a(s(1474)),i=a(s(4039)),u=a(s(2447)),l=a(s(2232));class d extends n.default{constructor(){super(),this.repliesCollection=o.default.getInstance(),this.instructorsAvailabilitySheet=new i.default}setScheduledMessages(){this.setPrivateMsgScheduleReminders(),this.setChannelScheduleReminder()}setPrivateMsgScheduleReminders(){const e=this.timeCollection.getScheduleTime("private_msg_schedule_reminder_1"),t=this.timeCollection.getScheduleTime("private_msg_schedule_reminder_2"),s=this.timeCollection.getTimeConfig("kyiv_time");r.default.schedule(e,this.sendScheduleStartPrivateReminders.bind(this),s),r.default.schedule(t,this.sendScheduleStartPrivateReminders.bind(this),s)}setChannelScheduleReminder(){const e=this.timeCollection.getScheduleTime("channel_schedule_reminder_1"),t=this.timeCollection.getScheduleTime("clear_rendered_schedule_sheets_time"),s=this.timeCollection.getScheduleTime("channel_schedule_reminder_2"),a=this.timeCollection.getTimeConfig("kyiv_time");r.default.schedule(t,this.clearPreviousWeekScheduleDays.bind(this),a),r.default.schedule(e,this.clearAllPreviousScheduleReplies.bind(this),a),r.default.schedule(e,this.sendFirstScheduleStartReminderToChannel.bind(this),a),r.default.schedule(s,this.sendScheduleStartReminderToChannel.bind(this),a)}async sendScheduleStartPrivateReminders(){const e=await this.instructorsAvailabilitySheet.getInstructorsChatIdsWithNoScheduleResponse();for(let t=0;t<e.length;t++){const{chatId:s,fullName:a}=e[t];let n=a.split(" ")[1];void 0===n&&(n=a.split(" ")[0]);let r=this.repliesCollection.getScheduleCmdReply("private_schedule_reminder");r=r.replace("$1",n);try{await this.tg.sendMessage(s,r)}catch(e){}}}sendScheduleStartReminderToChannel(){this.tg.sendMessage(process.env.TELEGRAM_CHANNEL_ID,this.repliesCollection.getScheduleCmdReply("channel_schedule_reminder"))}async clearAllPreviousScheduleReplies(){await this.instructorsAvailabilitySheet.clearAllPreviousScheduleReplies()}async clearPreviousWeekScheduleDays(){const e=new l.default,t=new u.default;await t.setAllDaysUnworkable(),await e.setAllDaysUnworkable()}async sendFirstScheduleStartReminderToChannel(){this.sendScheduleStartReminderToChannel()}}t.default=d,e.exports=d},2773:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5402)),r=a(s(4058));class o extends n.default{constructor(){super(),this.timeCollection=r.default.getInstance()}}t.default=o},6024:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(8311)),r=a(s(2773)),o=s(9889),i=a(s(2447)),u=a(s(2387)),l=a(s(9509)),d=a(s(6016));class c extends r.default{constructor(){super(),this.renderedScheduleSheet=new i.default}setScheduledMessages(){const e=this.timeCollection.getScheduleTime("every_day_full_schedule_reminder"),t=this.timeCollection.getTimeConfig("kyiv_time");n.default.schedule(e,this.sendFullNextDaySchedule.bind(this),t)}async sendFullNextDaySchedule(){if(!await this.renderedScheduleSheet.isNextDayWorkable())return;const e=await this.renderedScheduleSheet.getNextDayFullSchedule();let t=(0,o.renderOneDayScheduleFromSheet)(e);t=t.replace(/^/,"–¶–ï–ù–¢–†\n");try{const e=await this.tg.sendMessage(process.env.TELEGRAM_CHANNEL_ID,t);(new d.default).writeInstructorsToAccountingSheet(),u.default.getInstance().setCenterOneDayScheduleMessageId(l.default.nextDayName,e.message_id)}catch(e){console.log("Error on sending everyday schedule to channel",e)}}}t.default=c},9280:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(8311)),r=a(s(2773)),o=s(9889),i=a(s(2232)),u=a(s(2387)),l=a(s(9509)),d=a(s(5520));class c extends r.default{constructor(){super(),this.tripRenderedScheduleSheet=new i.default}setScheduledMessages(){const e=this.timeCollection.getScheduleTime("every_day_trip_full_schedule_reminder"),t=this.timeCollection.getTimeConfig("kyiv_time");n.default.schedule(e,this.sendFullNextDayTripSchedule.bind(this),t)}async sendFullNextDayTripSchedule(){if(!await this.tripRenderedScheduleSheet.isNextDayWorkable())return;const e=await this.tripRenderedScheduleSheet.getNextDayFullSchedule();let t=(0,o.renderOneDayScheduleFromSheet)(e);t=t.replace(/^/,"–í–ò–á–ó–î\n");try{const e=await this.tg.sendMessage(process.env.TELEGRAM_CHANNEL_ID,t);(new d.default).writeInstructorsToAccountingSheet(),u.default.getInstance().setTripOneDayScheduleMessageId(l.default.nextDayName,e.message_id)}catch(e){console.log("Error on sending everyday schedule to channel",e)}}}t.default=c},9889:(e,t)=>{function s(e,t){let s="";for(let t=0;t<e.length;t++){if(0===e[t].length)continue;const a=e[t][0];let n="\n";t>1&&(n="\n\n"),s=s+n+a}return t&&(s=s.replace(/^/,`${t}\n`)),s}Object.defineProperty(t,"__esModule",{value:!0}),t.renderNextDayInstructorReminderMessage=t.renderFullWorkableDaysSchedule=t.renderOneDayScheduleFromSheet=void 0,t.renderOneDayScheduleFromSheet=s,t.renderFullWorkableDaysSchedule=function(e,t){let a="";for(let t=0;t<e.length;t++)a+=`${s(e[t])}\n`;return a=a.replace(/^/,`${t}\n`),a},t.renderNextDayInstructorReminderMessage=function(e,t){const s=[],a={blood:"Mü©∏",lungs:"ARü´Å",heart:"CH‚ù§",evacuation:"–µ—è–∫—É–ª—è—Ü—ñ—èüöë"},n={},r={};for(const t in e){const s=e[t];for(let e=0;e<s.length;e++){const{name:a}=s[e];void 0===r[a]&&(r[a]=s[e]),void 0===n[a]&&(n[a]=[]),n[a].push(t)}}for(const e in r){const o=r[e],{chatId:i,name:u}=o;let l=u.split(" ")[1];void 0===l&&(l=u.split(" ")[0]);let d=t.getScheduleCmdReply("every_day_instructor_reminder"),c="";if(1===n[u].length)d=t.getScheduleCmdReply("every_day_instructor_reminder"),c=a[n[u][0]];else{d=t.getScheduleCmdReply("every_day_instructor_reminder_2");for(let e=0;e<n[u].length;e++)c+=`\n- ${a[n[u][e]]}`}d=d.replace("$1",l),d=d.replace("$2",c),s.push({chatId:i,message:d})}return s}},4705:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2773)),r=a(s(1474)),o=a(s(2447)),i=a(s(2232)),u=a(s(8311)),l=a(s(694));class d extends n.default{constructor(){super(),this.centerRenderedScheduleSheet=new o.default,this.tripRenderedScheduleSheet=new i.default}setScheduledMessages(){const e=this.timeCollection.getMakingPhotosReminder("make_photos_first_reminder"),t=this.timeCollection.getMakingPhotosReminder("make_photos_second_reminder"),s=this.timeCollection.getTimeConfig("kyiv_time");u.default.schedule(e,this.notifyInstructorsToMakePictures.bind(this),s),u.default.schedule(t,this.notifyInstructorsToSendPictures.bind(this),s)}async getAllTodayInstructorsIds(){const e=[...await this.centerRenderedScheduleSheet.getTodayInstructors(),...await this.tripRenderedScheduleSheet.getTodayInstructors()],t=[];return e.forEach((e=>{const s=l.default.getInstance().getUserId(e);s&&t.push(s)})),t}async notifyInstructorsToMakePictures(){const e=r.default.getInstance().getMakingPhotosReply("second_reminder");await this.notifyInstructors(e)}async notifyInstructorsToSendPictures(){const e=r.default.getInstance().getMakingPhotosReply("first_reminder");await this.notifyInstructors(e)}async notifyInstructors(e){const t=await this.getAllTodayInstructorsIds();for(let s=0;s<t.length;s++)try{await this.tg.sendMessage(t[s],e)}catch(e){console.log(e)}}}t.default=d},4910:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2773)),r=a(s(8311)),o=a(s(1474)),i=s(9889),u=a(s(2447));class l extends n.default{constructor(){super(),this.repliesCollection=o.default.getInstance(),this.renderedScheduleSheet=new u.default}setScheduledMessages(){const e=this.timeCollection.getScheduleTime("every_day_teaching_reminder"),t=this.timeCollection.getTimeConfig("kyiv_time");r.default.schedule(e,this.sendTomorrowInstructorsReminders.bind(this),t)}prepareMessages(e){e.forEach((e=>{e.message=e.message.replace(/^/,"(–¶–ï–ù–¢–†)\n")}))}async sendTomorrowInstructorsReminders(){if(!await this.renderedScheduleSheet.isNextDayWorkable())return;const e=await this.renderedScheduleSheet.getTomorrowInstructorsByBase(),t=(0,i.renderNextDayInstructorReminderMessage)(e,this.repliesCollection);this.prepareMessages(t);for(let e=0;e<t.length;e++){const{chatId:s,message:a}=t[e];try{await this.tg.sendMessage(s,a)}catch(e){}}}}t.default=l},1306:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2773)),r=a(s(8311)),o=a(s(1474)),i=s(9889),u=a(s(2232));class l extends n.default{constructor(){super(),this.repliesCollection=o.default.getInstance(),this.tripRenderedScheduleSheet=new u.default}setScheduledMessages(){const e=this.timeCollection.getScheduleTime("every_day_instructors_trip_reminder"),t=this.timeCollection.getTimeConfig("kyiv_time");r.default.schedule(e,this.sendTomorrowTripInstructorsReminders.bind(this),t)}prepareMessages(e){e.forEach((e=>{e.message=e.message.replace(/^/,"(–í–ò–á–ó–î)\n")}))}async sendTomorrowTripInstructorsReminders(){if(!await this.tripRenderedScheduleSheet.isNextDayWorkable())return;const e=await this.tripRenderedScheduleSheet.getTomorrowInstructorsByBase(),t=(0,i.renderNextDayInstructorReminderMessage)(e,this.repliesCollection);this.prepareMessages(t);for(let e=0;e<t.length;e++){const{chatId:s,message:a}=t[e];try{await this.tg.sendMessage(s,a)}catch(e){}}}}t.default=l},5540:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(832),r=s(6604),o=a(s(1820));class i extends o.default{constructor(e,t){super(),this.id=e,this.tg=new n.Telegram(process.env.TELEGRAM_BOT_TOKEN),this._name=t,this.updateTypesImplementations={[r.PRIVATE_UPDATE_TYPES.text]:this.onText.bind(this),[r.PRIVATE_UPDATE_TYPES.callback_query]:this.onCallbackQuery.bind(this),[r.PRIVATE_UPDATE_TYPES.animation]:this.onAnimation.bind(this),[r.PRIVATE_UPDATE_TYPES.audio]:this.onAudio.bind(this),[r.PRIVATE_UPDATE_TYPES.document]:this.onDocument.bind(this),[r.PRIVATE_UPDATE_TYPES.photo]:this.onPhoto.bind(this),[r.PRIVATE_UPDATE_TYPES.sticker]:this.onSticker.bind(this),[r.PRIVATE_UPDATE_TYPES.video]:this.onVideo.bind(this),[r.PRIVATE_UPDATE_TYPES.video_note]:this.onVideoNote.bind(this),[r.PRIVATE_UPDATE_TYPES.voice]:this.onVoice.bind(this),[r.PRIVATE_UPDATE_TYPES.edited_message]:this.onEditedMessage.bind(this),[r.PRIVATE_UPDATE_TYPES.command]:this.onCommand.bind(this)}}get name(){return this._name}async sendMessage(e){await this.tg.sendMessage(this.id.toString(),e)}finishCmd(){}notifyAboutCmdFinish(){this.finishCmd()}onUpdate(e){void 0!==this.updateTypesImplementations[e.updateType]?this.updateTypesImplementations[e.updateType](e):this.updateNotSupported(e.updateType)}updateNotSupported(e){console.log(`Update ${e} not supported`)}onCommand(e){this.noImplementationFound(e)}onCallbackQuery(e){this.noImplementationFound(e)}noImplementationFound(e){console.log(`Update type is ${e.updateType}, but no implementation in current handler (handler name - ${this.name}) found.`)}onText(e){this.noImplementationFound(e)}onAnimation(e){this.noImplementationFound(e)}onAudio(e){this.noImplementationFound(e)}onDocument(e){this.noImplementationFound(e)}onPhoto(e){this.noImplementationFound(e)}onSticker(e){this.noImplementationFound(e)}onVideo(e){this.noImplementationFound(e)}onVideoNote(e){this.noImplementationFound(e)}onVoice(e){this.noImplementationFound(e)}onEditedMessage(e){this.noImplementationFound(e)}}t.default=i},5638:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5502)),r=s(6604),o=a(s(2430));class i extends n.default{constructor(e,t){super(),this.id=e,this.handlers={},this.defaultHandler=new o.default(this.id),this.setDefaultHandler(),this.initHandlers(t)}initHandlers(e){e.forEach((e=>{const t=new e(this.id);this.handlers[t.name]=t}))}setCurrentHandler(e,t){this.currentHandler=this.handlers[e].copy(),this.currentHandler.onUpdate(t)}setDefaultHandler(){this.currentHandler=this.defaultHandler}onUpdate(e){e.updateType!==r.PRIVATE_UPDATE_TYPES.command?this.currentHandler.onUpdate(e):this.onCommand(e)}onCommand(e){const t=e.payload;void 0!==this.findHandlerByName(t.command)?this.setCurrentHandler(t.command,e):this.noCommandHandlerAvailable()}noCommandHandlerAvailable(){this.currentHandler.finishCmd(),this.setDefaultHandler()}findHandlerByName(e){return this.handlers[e]}}t.default=i},2885:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5540)),r=a(s(1474)),o=s(9785);class i extends n.default{constructor(e){super(e,o.CMD_NAMES.COMMANDS_INFO)}copy(){return new i(this.id)}onCommand(){const e=r.default.getInstance().getValueFromDocument("commands","commands_description");this.sendMessage(e)}}t.default=i},2430:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5540)),r=s(9785);class o extends n.default{constructor(e){super(e,r.CMD_NAMES.NONE)}copy(){return new o(this.id)}sendNotAvailableCmdMessage(){this.sendMessage("–î–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞—Ä–∞–∑—ñ –≤–∞–º –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –±–æ—Ç–∞.")}}t.default=o},4606:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5540)),r=s(9785),o=a(s(9181)),i=s(832),u=a(s(1184)),l=a(s(6347));class d extends n.default{constructor(e){super(e,r.CMD_NAMES.SAVE_PHOTO),this.strategy=new o.default(e,""),this.step=1}copy(){return new d(this.id)}setStrategy(e){this.strategy=e}onCommand(){this.step=1,this.level="",this.sendChooseLevelMarkup()}onCallbackQuery(e){this.onButtonClick(e)}async onButtonClick(e){const t=e.payload.callback_query.data;1===this.step?(this.level="ASM"===t?process.env.PHOTOS_DRIVE_FOLDER_ASM_ID:process.env.PHOTOS_DRIVE_FOLDER_CLS_ID,this.step++,this.sendChooseDateMarkup()):2===this.step&&("choose_date"===t?this.strategy=new l.default(this.id,this.level):"today"===t&&this.setStrategy(new u.default(this.id,this.level)))}sendChooseDateMarkup(){const e=i.Markup.inlineKeyboard([[{text:"–í–∫–∞–∑–∞—Ç–∏ –¥–∞—Ç—É",callback_data:"choose_date"}],[{text:"–ó–±–µ—Ä–µ–≥—Ç–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—é –¥–∞—Ç—É",callback_data:"today"}]]);this.tg.sendMessage(this.id,"–í–∏–±–µ—Ä—ñ—Ç—å —Å–ø–æ—Å—ñ–± –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å–≤—ñ—Ç–ª–∏–Ω–∏.",e)}sendChooseLevelMarkup(){const e=i.Markup.inlineKeyboard([[{text:"CLS",callback_data:"cls"},{text:"ASM",callback_data:"ASM"}]]);this.tg.sendMessage(this.id,"–í–∏–±–µ—Ä—ñ—Ç—å –≤ —è–∫—É –ø–∞–ø–∫—É –∑–±–µ—Ä–µ–≥—Ç–∏ —Å–≤—ñ—Ç–ª–∏–Ω–∏.",e)}onPhoto(e){this.strategy.onPhoto(e)}onDocument(e){this.strategy.onDocument(e)}onText(e){this.strategy.onText(e)}}t.default=d},7848:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5540)),r=a(s(9022)),o=s(9785),i=a(s(1474));class u extends n.default{constructor(e,t){super(e,o.CMD_NAMES.SAVE_PHOTO),this.uploadedImagesCounter=0,this.allowResponseOnDocumentLoad=!0,this.notLoadedImagesIds=[],this.saveFolderId=t,this.drivePhotosSaver=new r.default(t)}copy(){return new u(this.id,this.saveFolderId)}onCommand(){}async onPhoto(e){}onImageLoadFinish(e,t){this.uploadedImagesCounter--,e||this.notLoadedImagesIds.push(t),0===this.uploadedImagesCounter&&this.onAllImagesUploadFinish(t)}onAllImagesUploadFinish(e){this.notLoadedImagesIds.length>0?this.sendBackNotUploadedImages():this.sendMessage(i.default.getInstance().getSavePhotoCmdReply("photos_finished_load"))}async sendBackNotUploadedImages(){const e=[];this.notLoadedImagesIds.forEach((t=>{e.push({type:"photo",media:t})})),this.notLoadedImagesIds=[],await this.sendMessage(i.default.getInstance().getSavePhotoCmdReply("some_photos_not_loaded")),this.tg.sendMediaGroup(this.id,e)}onDocument(e){this.allowResponseOnDocumentLoad&&(this.sendMessage(i.default.getInstance().getSavePhotoCmdReply("document_load_reply")),this.allowResponseOnDocumentLoad=!1,setTimeout((()=>{this.allowResponseOnDocumentLoad=!0}),1e4))}onText(e){super.onText(e)}}t.default=u},9181:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(7848));class r extends n.default{constructor(e,t){super(e,t)}async onPhoto(e){this.sendMessage("–í–∏–±–µ—Ä—ñ—Ç—å —è–∫–∏–º —á–∏–Ω–æ–º –≤–∏ —Ö–æ—á–µ—Ç–µ –∑–±–µ—Ä—ñ–≥—Ç–∏ —Ñ–æ—Ç–æ.")}onDocument(e){this.sendMessage("–í–∏–±–µ—Ä—ñ—Ç—å —è–∫–∏–º —á–∏–Ω–æ–º –≤–∏ —Ö–æ—á–µ—Ç–µ –∑–±–µ—Ä—ñ–≥—Ç–∏ —Ñ–æ—Ç–æ.")}}t.default=r},1184:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(7848));class r extends n.default{constructor(e,t){super(e,t),this.onInit()}onInit(){this.sendMessage("–í–∏—Å–∏–ª–∞–π—Ç–µ –º–µ–Ω—ñ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ—ó, —è –∑–±–µ—Ä–µ–∂—É —ó—Ö –Ω–∞ –≥—É–≥–ª –¥–∏—Å–∫—É.")}async onPhoto(e){const t=e.payload.photo.pop(),s=await this.tg.getFileLink(t.file_id),a=Math.random()+s.pathname.slice(s.pathname.lastIndexOf("/"));this.uploadedImagesCounter++,this.drivePhotosSaver.savePhotoFromUrlToCurrentDayFolder({url:s.href,name:a}).then((e=>{this.onImageLoadFinish(e,t.file_id)}))}}t.default=r},6347:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(7848));class r extends n.default{constructor(e,t){super(e,t),this.date=null,this.onInit()}onInit(){this.sendMessage('–ù–∞–¥—ñ—à–ª—ñ—Ç—å –º–µ–Ω—ñ –¥–∞—Ç—É –∑—Ä–æ–±–ª–µ–Ω–∏—Ö —Ñ–æ—Ç–æ —É –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ - "21.08"')}async onPhoto(e){if(this.date){const t=e.payload.photo.pop(),s=await this.tg.getFileLink(t.file_id),a=Math.random()+s.pathname.slice(s.pathname.lastIndexOf("/"));this.uploadedImagesCounter++,this.drivePhotosSaver.savePhotoFromURLToSpecificDate({url:s.href,name:a},this.date).then((e=>{this.onImageLoadFinish(e,t.file_id)}))}else this.sendMessage('–°–ø–æ—á–∞—Ç–∫—É –≤–∫–∞–∂–∏ –¥–∞—Ç—É –≤ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ - "21.08"')}isValidDateFormat(e){return/^(0[1-9]|[12][0-9]|3[01])\.(0[1-9]|1[0-2])$/.test(e)}onText(e){const t=e.payload;this.isValidDateFormat(t.text)?(this.date=t.text,this.sendMessage(`–í–∏ –≤–∫–∞–∑–∞–ª–∏ –Ω–∞—Å—Ç—É–ø–Ω—É –¥–∞—Ç—É - "${t.text}". –¢–µ–ø–µ—Ä —á–µ–∫–∞—é –Ω–∞ —Å–≤—ñ—Ç–ª–∏–Ω–∏.`)):this.sendMessage('–ù–µ –≤–∞–ª—ñ–¥–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç–∏. –í–∫–∞–∂—ñ—Ç—å –¥–∞—Ç—É —É –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —Ñ–æ—Ä–º—ñ - "21.08"')}}t.default=r},495:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5540)),r=s(9785),o=a(s(7873)),i=s(8399),u=a(s(4039)),l=a(s(4883)),d=a(s(4103)),c=s(2356);class h extends n.default{constructor(e){super(e,r.CMD_NAMES.SCHEDULE),this.markupStatus={},this.markupEditor=new l.default,this.scheduleSheet=new u.default,this.msgResponder=new d.default(e),this.timeAccessController=new o.default,this.timeAccessController.init()}copy(){return new h(this.id)}onCommand(e){this.requestScheduleMarkup(e)}onCallbackQuery(e){this.onButtonClick(e)}requestScheduleMarkup(e){if(!this.timeAccessController.accessible)return void this.msgResponder.notifyUserAboutClosedSchedule();const t=e.payload;this.markupStatus[t.messageId]=c.SCHEDULE_MARKUP_STATUS.active,this.msgResponder.sendDefaultMarkupWithDescription(this.markupEditor.getDefaultMarkup())}async onButtonClick(e){const t=e.payload,s=t.callback_query.data;this.markupStatus[t.messageId]!==c.SCHEDULE_MARKUP_STATUS.sending&&(this.markupStatus[t.messageId]!==c.SCHEDULE_MARKUP_STATUS.unactive?s!==i.confirmScheduleBtnText?(this.markupEditor.handleDayChoiceClick(t),this.markupEditor.checkUpdatedMarkupEquality()||await this.msgResponder.editMarkup(t.messageId,void 0,this.markupEditor.getModifiedMarkup())):await this.confirmSchedule(t.messageId):this.msgResponder.notifyUserAboutUnactiveMarkup())}async confirmSchedule(e){this.timeAccessController.accessible?this.markupEditor.checkIfScheduleFilled()?(this.markupStatus[e]=c.SCHEDULE_MARKUP_STATUS.sending,await this.msgResponder.editMarkup(e,void 0,this.markupEditor.getPendingMarkup()),await this.scheduleSheet.updateUserSchedule(this.id,this.markupEditor.userSchedule).then((()=>{this.msgResponder.sendConfirmedScheduleReply(),this.msgResponder.editMarkup(e,void 0,this.markupEditor.getConfirmedMarkup()),this.markupStatus[e]=c.SCHEDULE_MARKUP_STATUS.unactive})).catch((()=>{this.msgResponder.respondWithUnsuccessfulSpreadsheetInput(),this.markupStatus[e]=c.SCHEDULE_MARKUP_STATUS.unactive}))):this.msgResponder.notifyUserToFillSchedule():this.msgResponder.notifyUserAboutClosedSchedule()}}t.default=h},4103:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2833)),r=a(s(1474)),o=a(s(9982));class i extends n.default{constructor(e){super(e),this.repliesCollection=r.default.getInstance()}async sendDefaultMarkupWithDescription(e){const t=this.repliesCollection.getScheduleCmdReply("schedule_markup_description");this.tg.sendMessage(this.targetId,t,e)}async editMarkup(e,t,s){await this.tg.editMessageReplyMarkup(this.targetId,e,void 0,s.reply_markup)}notifyUserAboutClosedSchedule(){this.sendMessage(this.repliesCollection.getScheduleCmdReply("schedule_closed"))}notifyUserToFillSchedule(){this.sendMessage(this.repliesCollection.getScheduleCmdReply("schedule_must_be_filled_before_sending"))}sendConfirmedScheduleReply(){this.sendMessage(this.repliesCollection.getScheduleCmdReply("confirmed_schedule_reply")),this.tg.sendSticker(this.targetId,o.default.getInstance().getStickerId("maks_tak_trimaty"))}respondWithUnsuccessfulSpreadsheetInput(){this.sendMessage(this.repliesCollection.getScheduleCmdReply("unsuccessful_schedule_input"))}async respondWithWaitForScheduleSending(){return await this.sendMessage(this.repliesCollection.getScheduleCmdReply("schedule_is_being_sent_response"))}notifyUserAboutUnactiveMarkup(){this.sendMessage(this.repliesCollection.getScheduleCmdReply("chosen_schedule_markup_not_active"))}}t.default=i},7873:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2748),r=a(s(4058)),o=a(s(8311)),i=a(s(881));class u extends i.default{constructor(){super(),this.initialized=!1}init(){this.initialized||(this.setAccessibilityStatusOnInit(),this.setAccessibilityModifiers(),this.initialized=!0)}setAccessibilityModifiers(){const e=r.default.getInstance(),t=e.getScheduleTime("open_schedule_time"),s=e.getScheduleTime("close_schedule_time"),a=e.getTimeConfig("kyiv_time");o.default.schedule(t,this.setAccessible.bind(this),a),o.default.schedule(s,this.setUnAccessible.bind(this),a)}setAccessibilityStatusOnInit(){let e=!1;const t=n.DateTime.now();t.setZone("Europe/Kiev");const s=n.DateTime.now();s.setZone("Europe/Kiev");const a=t.minus({days:t.weekday});let r=a.plus({days:4});r=r.set({hour:18,minute:0,second:0});let o=a.plus({days:7});o=o.set({hour:17,minute:0,second:0}),s>=r&&s<=o&&(e=!0),console.log("–ó–∞–ø–∏—Å —É —Ä–æ–∑–∫–ª–∞–¥ "+(e?"–≤—ñ–¥–∫—Ä–∏—Ç–∏–π":"–∑–∞–∫—Ä–∏—Ç–∏–π")),this.accessible=e}}t.default=u},4883:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3453)),r=s(9785),o=s(8399);t.default=class{constructor(){this.markupViewCreator=new n.default,this.setDefaultUserSchedule()}get userSchedule(){return Object.assign({},this._userSchedule)}getDefaultMarkup(){return this.setDefaultUserSchedule(),this.markupViewCreator.getDefaultMarkup(this._userSchedule)}getPendingMarkup(){return this.markupViewCreator.getPendingMarkup(this._userSchedule)}getModifiedMarkup(){return this.markupViewCreator.getDefaultMarkup(this._userSchedule)}checkUpdatedMarkupEquality(){const e=this.markupViewCreator.getDefaultMarkup(this._userSchedule).reply_markup,t=JSON.stringify(e)===JSON.stringify(this.previouslySentMarkup);return this.previouslySentMarkup=this.markupViewCreator.getDefaultMarkup(this._userSchedule).reply_markup,t}handleDayChoiceClick(e){const t=e.callback_query.data;this._userSchedule[t]=!this._userSchedule[t],t===o.notAvailableInstructor?this.clearAllDaysIfInstructorUnavailable():this.makeInstructorAvailable()}clearAllDaysIfInstructorUnavailable(){if(this._userSchedule[o.notAvailableInstructor])for(const e in this._userSchedule)e!==o.notAvailableInstructor&&(this._userSchedule[e]=!1)}makeInstructorAvailable(){this._userSchedule[o.notAvailableInstructor]=!1}getConfirmedMarkup(){return this.markupViewCreator.getDefaultMarkup(this._userSchedule,!0)}checkIfScheduleFilled(){for(const e in this._userSchedule)if(!0===this._userSchedule[e])return!0;return!1}setDefaultUserSchedule(){this._userSchedule={[r.DayNames.monday]:!1,[r.DayNames.tuesday]:!1,[r.DayNames.wednesday]:!1,[r.DayNames.thursday]:!1,[r.DayNames.friday]:!1,[r.DayNames.saturday]:!1,[r.DayNames.sunday]:!1,[o.notAvailableInstructor]:!1}}}},3453:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(8399),n=s(9785),r=s(832),o={[n.DayNames.monday]:"–ü–ù",[n.DayNames.tuesday]:"–í–¢",[n.DayNames.wednesday]:"–°–†",[n.DayNames.thursday]:"–ß–¢",[n.DayNames.friday]:"–ü–¢",[n.DayNames.saturday]:"–°–ë",[n.DayNames.sunday]:"–ù–î"};t.default=class{getDefaultMarkup(e,t=!1){const s=this.getMarkup(e);return s.push([this.getConfirmButtonMarkup(t)]),r.Markup.inlineKeyboard(s)}getMarkup(e){const{monday:t,tuesday:s,wednesday:r,thursday:o,friday:i,saturday:u,sunday:l}=n.DayNames;return[[this.getChosenDayBtnMarkup(t,t,e[t]),this.getChosenDayBtnMarkup(s,s,e[s]),this.getChosenDayBtnMarkup(r,r,e[r])],[this.getChosenDayBtnMarkup(o,o,e[o]),this.getChosenDayBtnMarkup(i,i,e[i]),this.getChosenDayBtnMarkup(u,u,e[u])],[this.getChosenDayBtnMarkup(l,l,e[l]),this.getBtnMarkup(a.notAvailableInstructor,a.notAvailableInstructor,e[a.notAvailableInstructor])]]}getPendingMarkup(e){const t=this.getMarkup(e);return t.push([this.getPendingConfirmButtonMarkup()]),r.Markup.inlineKeyboard(t)}getConfirmButtonMarkup(e=!1){return{text:a.confirmScheduleBtnText+(e?"üî•":" ‚û°"),callback_data:a.confirmScheduleBtnText}}getPendingConfirmButtonMarkup(){return{text:a.confirmScheduleBtnText+"...",callback_data:a.confirmScheduleBtnText}}getBtnMarkup(e,t,s=!1){return{text:e+(s?" ‚úÖ":""),callback_data:t}}getChosenDayBtnMarkup(e,t,s=!1){let a=e;return void 0!==o[e]&&(a=o[e]),this.getBtnMarkup(a,t,s)}}},8399:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.noResponseInstructorsColumn=t.numberOfRowsInRenderedSchedule=t.fullScheduleByDayLetters=t.baseInstructorsByLetters=t.confirmScheduleBtnText=t.notAvailableInstructor=t.dayNamesByCellsLettersInSheet=void 0;const a=s(9785),n="–í—ñ–¥—Å—É—Ç–Ω—ñ–π(–Ω—è)";t.notAvailableInstructor=n,t.noResponseInstructorsColumn="M",t.confirmScheduleBtnText="–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò";const r={[a.DayNames.monday]:"C",[a.DayNames.tuesday]:"D",[a.DayNames.wednesday]:"E",[a.DayNames.thursday]:"F",[a.DayNames.friday]:"G",[a.DayNames.saturday]:"H",[a.DayNames.sunday]:"I",[n]:"J"};t.dayNamesByCellsLettersInSheet=r,t.baseInstructorsByLetters={Monday:{blood:"A",lungs:"B",heart:"C",evacuation:"D"},Tuesday:{blood:"F",lungs:"G",heart:"H",evacuation:"I"},Wednesday:{blood:"K",lungs:"L",heart:"M",evacuation:"N"},Thursday:{blood:"P",lungs:"Q",heart:"R",evacuation:"S"},Friday:{blood:"U",lungs:"V",heart:"W",evacuation:"X"},Saturday:{blood:"Z",lungs:"AA",heart:"AB",evacuation:"AC"},Sunday:{blood:"AE",lungs:"AF",heart:"AG",evacuation:"AH"}},t.fullScheduleByDayLetters={Monday:"A",Tuesday:"B",Wednesday:"C",Thursday:"D",Friday:"E",Saturday:"F",Sunday:"G"},t.numberOfRowsInRenderedSchedule=14},2356:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.SCHEDULE_MARKUP_STATUS=void 0,(s=t.SCHEDULE_MARKUP_STATUS||(t.SCHEDULE_MARKUP_STATUS={})).unactive="unactive",s.sending="sending",s.active="active"},8245:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5540)),r=s(9785),o=a(s(1474));class i extends n.default{constructor(e){super(e,r.CMD_NAMES.START)}copy(){return new i(this.id)}onCommand(){const e=o.default.getInstance().getValueFromDocument("start","bot_introduction");this.sendMessage(e)}}t.default=i},8326:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5540)),r=s(9785),o=s(5908),i=a(s(2378));class u extends n.default{constructor(e){super(e,r.CMD_NAMES.SEND_TIMING)}onCommand(e){this.sendMessage("–ù–∞–¥—ñ—à–ª–∏ –º–µ–Ω—ñ —á–∞—Å —Å—Ç–∞—Ä—Ç—É –∑–∞–Ω—è—Ç—å —É –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ - 10:40.")}async onText(e){const t=e.payload,s=this.validateTimeFormat(t.text);if("boolean"==typeof s){const e=this.generateTiming(t.text);await this.tg.sendMessage(process.env.TELEGRAM_CHANNEL_ID,e)}else await this.sendMessage(s)}generateTiming(e){const t=e.split(":"),s=Number(t[0]),a=Number(t[1]),n=i.default.getInstance().getCenterTiming(),r=[];let u=(0,o.newValidDate)(2022,6,3,s,a),l=(0,o.newValidDate)(2022,6,3,s,a);r.push((0,o.format)(u,"HH:mm"));for(let e=0;e<n.length;e++){u=(0,o.addMinutes)(u,n[e]);const t=(0,o.format)(u,"HH:mm"),s=(0,o.format)(l,"HH:mm");t&&(e>0&&s&&r.push(s),r.push(t)),l=u}return this.generateMessage(r)}generateMessage(e){return`–ì–†–ê–§–Ü–ö üï∞\n\nü©∏M ${e[0]}-${e[1]}\n \n        \nüèù–ü–µ—Ä–µ—Ä–≤–∞ ${e[2]}-${e[3]}\n\n        \nü´Å${e[4]}-${e[5]}\n\n        \nüçî–û–±—ñ–¥ ${e[6]} - ${e[7]}\n \n            \nü´®CH ${e[8]} - ${e[9]}\n \n          \nüèù–ü–µ—Ä–µ—Ä–≤–∞ ${e[10]} - ${e[11]}\n \n            \nüöë–ï–≤–∞–∫—É–∞—Ü—ñ—è ${e[12]} - ${e[13]}\n \n            \nüèù–ü–µ—Ä–µ—Ä–≤–∞ ${e[14]} - ${e[15]}\n \n            \nüé™–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –∞–ª–≥–æ—Ä–∏—Ç–º—É —ñ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º –Ω–∞ –±–∞–∑—ñ ${e[16]} - ${e[17]}\n \n            \nüß†–°–∏–Ω—Ç–µ–∑ –∞–ª–≥–æ—Ä–∏—Ç–º—É –Ω–∞ —Å–≤–æ—ó—Ö –±–∞–∑–∞—Ö ${e[18]} - ${e[19]}\n \n            \nüèù–ü–µ—Ä–µ—Ä–≤–∞ ${e[20]} - ${e[21]}\n \n            \nüíª–°–ò–ú–£–õ–Ø–¶–Ü–Ø ${e[22]} - ${e[23]}\n \n             \nüì£–î–µ–±—Ä–∏—Ñ—ñ–Ω–≥ –ø–æ —Å–∏–º—É–ª—è—Ü—ñ—ó –∑ –∫—É—Ä—Å–∞–Ω—Ç–∞–º–∏ ${e[24]} - ${e[25]}\n\n            \n–ó–±—ñ—Ä —Å—Ç–∞—Ñ—É (–≤–µ—Å–µ–ª—ñ—Ç—å—Å—è —Å–∫—ñ–ª—å–∫–∏ —Ö–æ—á–µ—Ç–µ).\n        `}validateTimeFormat(e){return!!/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(e)||'–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç —á–∞—Å—É. –§–æ—Ä–º–∞—Ç –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ "HH:mm", –¥–µ HH - –≥–æ–¥–∏–Ω–∏ (–≤—ñ–¥ 00 –¥–æ 23), –∞ mm - —Ö–≤–∏–ª–∏–Ω–∏ (–≤—ñ–¥ 00 –¥–æ 59).'}copy(){return new u(this.id)}}t.default=u},9386:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(4058)),r=a(s(760)),o=a(s(1474)),i=a(s(2187)),u=a(s(694)),l=a(s(9982)),d=a(s(2387)),c=a(s(2378));t.default=class{async init(){await this.initDataBase(),await this.initCollectionManagers()}async initCollectionManagers(){const e=[n.default.getInstance(),o.default.getInstance(),i.default.getInstance(),u.default.getInstance(),l.default.getInstance(),d.default.getInstance(),c.default.getInstance()];for(let t=0;t<e.length;t++){const s=e[t];await s.init()}}async initDataBase(){const e=new r.default;await e.initDataBase()}}},6907:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.data={}}}},760:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(6907)),r=s(325),o=a(s(8971)),i=s(2594);class u extends n.default{constructor(){super()}get allRemoteData(){return this.data}async initDataBase(){await this.initApp(),await this.loadRemoteData()}async loadRemoteData(){const e=(0,i.getFirestore)(),t=await e.listCollections();for(let e=0;e<t.length;e++){const s=t[e],a=await s.listDocuments(),n={};for(let e=0;e<a.length;e++){const t=a[e],r=await t.get(),o=await r.data();void 0!==o&&(n[r.id]=o,this.setActionOnDocumentSnapshotOnAppLoad({collection:s,document:t}))}this.data[s.id]=n}}async initApp(){await(0,r.initializeApp)({credential:(0,r.cert)(o.default.serviceAccountCredentials)})}setActionOnDocumentSnapshotOnAppLoad({collection:e,document:t}){let s=!1;t.onSnapshot((async a=>{if(s){const s=await a.data(),n=e.id;if(this.data[n]){const e=this.data[n];void 0!==s&&(e[t.id]=s)}}s=!0}),(e=>{console.log(`Encountered error: ${e}`)}))}}t.default=u},3155:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(9679)),r=s(2594);t.default=class{constructor(e){this.collectionName=e,this.collection={},this.initialized=!1}async init(){if(this.initialized)return;const e=new n.default(this.collection,this.collectionName);await e.setUpdates(),this.initialized=!0}getValueFromDocument(e,t){const s=this.getDocument(e);if(void 0!==s)return this.getValue(s,t)}getAllDocumentValues(e){return Object.assign({},this.collection[e])}getValue(e,t){let s=e[t];return"string"==typeof s&&(s=s.replaceAll("<br />","\n")),s}async updateValue(e,t,s){return(await this.getDocumentClass(e)).update({[t]:s})}async updateMultipleValues(e,t){return(await this.getDocumentClass(e)).update(t)}async getDocumentClass(e){const t=(0,r.getFirestore)();return(await t.collection(this.collectionName)).doc(e)}getDocument(e){return this.collection[e]}}},9679:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(2594);t.default=class{constructor(e,t){this.collection=e,this.collectionName=t}async setUpdates(){const e=(0,a.getFirestore)(),t=await e.collection(this.collectionName),s=await t.listDocuments();for(let e=0;e<s.length;e++){const t=s[e];await this.setUpdateHook(t)}}async setUpdateHook(e){await new Promise((t=>{e.onSnapshot((async e=>{const s=await this.updateCollection(e);t(s)}))}))}async updateCollection(e){const t=await e.data();void 0!==t&&(this.collection[e.id]=t)}}},1474:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3155));class r extends n.default{constructor(){super("reply_messages")}getScheduleCmdReply(e){return this.getValueFromDocument("schedule",e)}getSavePhotoCmdReply(e){return this.getValueFromDocument("save_photos",e)}getMakingPhotosReply(e){return this.getValueFromDocument("makePhotosReminder",e)}static getInstance(){if(null===r.uniqueInstance){const e=new r;return r.uniqueInstance=e,e}return r.uniqueInstance}}t.default=r,r.uniqueInstance=null},2387:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3155)),r=s(9785),o=a(s(8311));class i extends n.default{constructor(){super("schedule_updates"),this.setupDelayedUpdates()}setupDelayedUpdates(){const e={scheduled:!0,timeZone:"Europe/Kiev"};o.default.schedule("0 0 0 * * Sunday",this.eraseLastWeekMessagesData.bind(this),e),o.default.schedule("0 0 20 * * Sunday",this.allowMessagesEditing.bind(this),e)}async eraseLastWeekMessagesData(){const e={[r.DayNames.monday]:0,[r.DayNames.tuesday]:0,[r.DayNames.wednesday]:0,[r.DayNames.thursday]:0,[r.DayNames.friday]:0,[r.DayNames.saturday]:0,[r.DayNames.sunday]:0,lastFullScheduleMessageId:0};await this.updateMultipleValues("center",e),await this.updateMultipleValues("trips",e)}allowMessagesEditing(){this.setUpdateAvailability(!0)}async updateScheduleMessagesIdsAndAllowEdit(e){const{fullScheduleTripsMsg:t,fullScheduleCenterMsg:s}=e;(s||t)&&(await this.setUpdateAvailability(!0),await this.eraseLastWeekMessagesData()),void 0!==s&&await this.setCenterFullScheduleId(s.message_id),void 0!==t&&await this.setTripFullScheduleId(t.message_id)}get isUpdateAvailable(){return this.getValueFromDocument("options","updateAvailable")}getCenterOneDayScheduleMsgId(e){return this.getValueFromDocument("center",e)}getCenterFullScheduleMsgId(){return this.getValueFromDocument("center","lastFullScheduleMessageId")}getTripFullScheduleMsgId(){return this.getValueFromDocument("trips","lastFullScheduleMessageId")}getTripOneDayScheduleMsgId(e){return this.getValueFromDocument("trips",e)}setCenterFullScheduleId(e){return this.updateCenterScheduleValue("lastFullScheduleMessageId",e)}setTripFullScheduleId(e){return this.updateTripScheduleValue("lastFullScheduleMessageId",e)}setCenterOneDayScheduleMessageId(e,t){return this.updateCenterScheduleValue(e,t)}setTripOneDayScheduleMessageId(e,t){return this.updateTripScheduleValue(e,t)}setUpdateAvailability(e){return this.updateValue("options","updateAvailable",e)}async updateCenterScheduleValue(e,t){return this.updateValue("center",e,t)}async updateTripScheduleValue(e,t){return this.updateValue("trips",e,t)}static getInstance(){if(null===i.uniqueInstance){const e=new i;return i.uniqueInstance=e,e}return i.uniqueInstance}}t.default=i,i.uniqueInstance=null},2187:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3155));class r extends n.default{constructor(){super("google_sheets")}getSheetName(e){return this.getValueFromDocument("schedule_sheets_names",e)}static getInstance(){if(null===r.uniqueInstance){const e=new r;return r.uniqueInstance=e,e}return r.uniqueInstance}}t.default=r,r.uniqueInstance=null},9982:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3155));class r extends n.default{constructor(){super("stickers")}getStickerId(e){return this.getValueFromDocument("sticker_strings",e)}static getInstance(){if(null===r.uniqueInstance){const e=new r;return r.uniqueInstance=e,e}return r.uniqueInstance}}t.default=r,r.uniqueInstance=null},4058:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3155));class r extends n.default{constructor(){super("time_values")}getScheduleTime(e){return this.getValueFromDocument("schedule",e)}getTimeConfig(e){return this.getValueFromDocument("time_configs",e)}getMakingPhotosReminder(e){return this.getValueFromDocument("reminders",e)}static getInstance(){if(null===r.uniqueInstance){const e=new r;return r.uniqueInstance=e,e}return r.uniqueInstance}}t.default=r,r.uniqueInstance=null},2378:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3155));class r extends n.default{constructor(){super("timings")}getCenterTiming(){return this.getValueFromDocument("center","classes_timing")}static getInstance(){if(null===r.uniqueInstance){const e=new r;return r.uniqueInstance=e,e}return r.uniqueInstance}}t.default=r,r.uniqueInstance=null},694:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3155));class r extends n.default{constructor(){super("users")}getUserName(e){return this.getValueFromDocument("names",e)}getUserFullName(e){return this.getValueFromDocument("fullNames",e)}getUserId(e){return this.getValueFromDocument("ids",e)}static getInstance(){if(null===r.uniqueInstance){const e=new r;return r.uniqueInstance=e,e}return r.uniqueInstance}}t.default=r,r.uniqueInstance=null},4349:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5142));t.default=class{static load(){n.default.config();const{mode:e}=process.env;"development"!==e&&"test"!==e||this.loadDevEnvVariables(),"production"===e&&this.loadProdEnvVariables()}static loadDevEnvVariables(){process.env.TELEGRAM_BOT_TOKEN=process.env.TELEGRAM_BOT_TOKEN_DEVELOPMENT,process.env.TELEGRAM_CHANNEL_ID=process.env.TELEGRAM_CHANNEL_ID_DEVELOPMENT,process.env.SCHEDULE_SPREADSHEET_ID=process.env.SCHEDULE_SPREADSHEET_ID_DEVELOPMENT}static loadProdEnvVariables(){process.env.TELEGRAM_BOT_TOKEN=process.env.TELEGRAM_BOT_TOKEN_PRODUCTION,process.env.TELEGRAM_CHANNEL_ID=process.env.TELEGRAM_CHANNEL_ID_PRODUCTION,process.env.SCHEDULE_SPREADSHEET_ID=process.env.SCHEDULE_SPREADSHEET_ID_PRODUCTION}}},3301:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(6860)),r=a(s(3582)),o=a(s(3986));t.default=class{constructor(){this.app=(0,n.default)(),this.init()}init(){this.app.use((0,r.default)()),this.app.use(o.default.json()),this.app.use(o.default.urlencoded()),this.app.get("/",(function(e,t){t.send("<button onclick=\"function myFunction() {console.log('hui')}\">Click me</button>")})),this.app.listen(process.env.PORT||3e3,(()=>console.log("Server is running...")))}subscribeSpreadSheetRequestSubject(e){this.app.post("/spreadSheetUpdate",((t,s)=>{console.log(t.body),e.notifyObservers(t.body.requestName,t.body),s.status(200).json({message:"It worked!"})}))}}},5062:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(6781),r=a(s(8971));class o{constructor(){if(null!==o.instance)return o.instance;o.instance=this}async authorize(){o.authObj||(o.authObj=await new n.GoogleAuth({credentials:r.default.serviceAccountCredentials,scopes:["https://www.googleapis.com/auth/spreadsheets","https://www.googleapis.com/auth/drive"]}))}static get authenticationObject(){return o.authObj}}t.default=o,o.instance=null},9022:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(3573)),r=a(s(9509)),o=s(5908);class i extends n.default{constructor(e){super(),this.folderCreationPromise=null,this.existingFolderNames=[],this.folderId=e}checkCurrentMonthFolderExistenceLocal(){return this.existingFolderNames.includes(this.currentMonthFolderName)}async saveImageImmediatelyToDriveFolder(e){const t=await this.getCurrentDayFolderId();return super.savePhotoFromURL({url:e.url,name:e.name,folderId:t})}async createDriveFolderAndSaveImage(e){return null===this.folderCreationPromise&&(this.folderCreationPromise=this.getCurrentDayFolderId(),this.folderCreationPromise.then((()=>{this.folderCreationPromise=null}))),new Promise((async t=>{if(null===this.folderCreationPromise)return void t(!1);const s=await this.folderCreationPromise;t(await super.savePhotoFromURL({url:e.url,name:e.name,folderId:s}))}))}async savePhotoFromUrlToCurrentDayFolder(e){return this.checkCurrentMonthFolderExistenceLocal()?this.saveImageImmediatelyToDriveFolder(e):this.createDriveFolderAndSaveImage(e)}async getCurrentMonthFolderId(){const e=`mimeType='application/vnd.google-apps.folder' and '${this.folderId}' in parents and name='${this.currentMonthFolderName}'`,t=await this.drive.files.list({spaces:"drive",q:e});let s="";return 1===t.data.files?.length?s=t.data.files[0].id:0===t.data.files?.length&&(s=await this.createCurrentMonthFolder()),s}async savePhotoFromURLToSpecificDate(e,t){const s=`${r.default.getMonthNames()[Number(t.split(".")[1])-1]} ${(new Date).getFullYear()}`;let a=await this.getFolderId(this.folderId,s);a||(a=await this.createPhotoStorageFolder(s,this.folderId));let n=await this.getFolderId(a,t);return n||(n=await this.createPhotoStorageFolder(t,a)),super.savePhotoFromURL({url:e.url,name:e.name,folderId:n})}async getFolderId(e,t){const s=`mimeType='application/vnd.google-apps.folder' and '${e}' in parents and name='${t}'`,a=await this.drive.files.list({spaces:"drive",q:s});let n="";return 1===a.data.files?.length&&(n=a.data.files[0].id),n}async getCurrentDayFolderId(){const e=`mimeType='application/vnd.google-apps.folder' and '${await this.getCurrentMonthFolderId()}' in parents and name='${this.currentDayFolderName}'`,t=await this.drive.files.list({spaces:"drive",q:e});let s="";return 1===t.data.files?.length?s=t.data.files[0].id:0===t.data.files?.length&&(s=await this.createCurrentDayFolder()),s}async createPhotoStorageFolder(e,t){const s={name:e,mimeType:"application/vnd.google-apps.folder",parents:[t]};try{return(await this.drive.files.create({resource:s,fields:"id"})).data.id}catch(e){console.warn("Can`t create folder",e)}return""}async createCurrentDayFolder(){return await this.createPhotoStorageFolder(this.currentDayFolderName,await this.getCurrentMonthFolderId())}async createCurrentMonthFolder(){const e={name:this.currentMonthFolderName,mimeType:"application/vnd.google-apps.folder",parents:[this.folderId]};try{return(await this.drive.files.create({resource:e,fields:"id"})).data.id}catch(e){console.warn("Can`t create folder",e)}return""}get currentDayFolderName(){return`${(0,o.format)(new Date,"DD.MM")}`}get currentMonthFolderName(){const e=new Date;return`${r.default.getMonthNames()[e.getMonth()]} ${e.getFullYear()}`}}t.default=i},3573:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(839)),r=s(2781),o=a(s(5687));class i extends n.default{constructor(){super()}async savePhotoFromURL(e){return new Promise(((t,s)=>{o.default.request(e.url,(s=>{const a=new r.Transform;s.on("data",(e=>{a.push(e)})),s.on("end",(async()=>{const s=r.Readable.from(a.read()),n=await this.savePhotoToDriveFolder({buffer:s,name:e.name,folderId:e.folderId});t(n)}))})).end()}))}async savePhotoToDriveFolder(e){try{return await this.drive.files.create({uploadType:"media",requestBody:{name:e.name,parents:[e.folderId]},media:{body:e.buffer}}),console.log("Photo saved successfully"),!0}catch(e){return console.warn("Can't save photos",e),!1}}}t.default=i},1083:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(839)),r=s(5908),o=a(s(15));class i extends n.default{constructor(e){super(),this.name=e}get numberOfDaysInCurrentMonth(){return new Date((new Date).getFullYear(),(new Date).getMonth()+1,0).getDate()}async getCurrentMonthSheetId(){const e=`mimeType='application/vnd.google-apps.spreadsheet' and '${process.env.ACCOUNTING_DRIVE_FOLDER_ID}' in parents and name='${this.currentMonthSheetName}'`,t=await this.drive.files.list({spaces:"drive",q:e});let s="";return 1===t.data.files?.length?s=t.data.files[0].id:0===t.data.files?.length&&(s=await this.createSheetForCurrentMonth()),s}get currentMonthSheetName(){const e=(0,r.addHours)(new Date,24);return`${this.name}${(0,r.format)(e,"MM.YYYY")}`}async createSheetForCurrentMonth(){const e={name:this.currentMonthSheetName,mimeType:"application/vnd.google-apps.spreadsheet",parents:[process.env.ACCOUNTING_DRIVE_FOLDER_ID]};try{const t=await this.drive.files.create({resource:e,fields:"id"});return await new o.default(t.data.id).fillNewSheetWithDatesAndInstructorNames(this.numberOfDaysInCurrentMonth),t.data.id}catch(e){console.warn("Can`t create spreadsheet",e)}return""}async writeTomorrowInstructorsToAccountingSheet(e){const t=new o.default(await this.getCurrentMonthSheetId());await t.writeTomorrowInstructorsToSpreadsheet(e)}}t.default=i},2291:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(9326)),r=a(s(2187)),o=a(s(694));class i extends n.default{constructor(){super(process.env.SCHEDULE_SPREADSHEET_ID),this.sheetCollection=r.default.getInstance()}getInstructorsIdsByNames(e=[]){const t=o.default.getInstance().getAllDocumentValues("ids"),s=[];for(let a=0;a<e.length;a++){const n=e[a],r=t[n];s.push({name:n,chatId:r})}return s}}t.default=i},4039:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2291)),r=s(8399),o=a(s(694)),i=s(9785);class u extends n.default{constructor(){super(),this.usersCollection=o.default.getInstance()}async clearAllPreviousScheduleReplies(){const e=r.dayNamesByCellsLettersInSheet[i.DayNames.monday],t=r.dayNamesByCellsLettersInSheet[r.notAvailableInstructor],s=this.sheetCollection.getSheetName("instructors_availability"),a=`${s}!${e}2:${t}`,n=await this.getSheetValues({range:a});for(let e=0;e<n.length;e++){const t=n[e];for(let e=0;e<t.length;e++)t[e]="FALSE"}const o=`${s}!${e}2:${t}${n.length+1}`;await this.updateSheetValues({range:o,values:n,majorDimension:"ROWS"})}async updateUserSchedule(e,t){const s=this.usersCollection.getUserFullName(e.toString()),a=await this.getUserRowIndexInAvailabilitySheet(s);null!==a?(await this.clearPreviousSchedule(a),await this.setScheduleInSpreadsheet(a,t)):console.log("No such instructor in availability sheet !")}async getUserRowIndexInAvailabilitySheet(e){const t=`${this.sheetCollection.getSheetName("instructors_availability")}!A:A`,s=await this.getSheetValues({range:t});let a=null;for(let t=0;t<s.length;t++)if(e===s[t][0]){a=t+1;break}return a}async setScheduleInSpreadsheet(e,t){const s=r.dayNamesByCellsLettersInSheet[i.DayNames.monday]+e,a=r.dayNamesByCellsLettersInSheet[r.notAvailableInstructor]+e,n=`${this.sheetCollection.getSheetName("instructors_availability")}!${s}:${a}`,o=[t[i.DayNames.monday],t[i.DayNames.tuesday],t[i.DayNames.wednesday],t[i.DayNames.thursday],t[i.DayNames.friday],t[i.DayNames.saturday],t[i.DayNames.sunday],t[r.notAvailableInstructor]].map((e=>[e.toString().toUpperCase()]));try{await this.updateSheetValues({values:o,range:n}).then((()=>{console.log("Schedule was successfully sent !")}))}catch(e){throw console.log("Schedule sending is unsuccessfull, abort !"),e}}async clearPreviousSchedule(e){const t=r.dayNamesByCellsLettersInSheet[i.DayNames.monday]+e,s=r.dayNamesByCellsLettersInSheet[r.notAvailableInstructor]+e,a=`${this.sheetCollection.getSheetName("instructors_availability")}!${t}:${s}`,n=[["FALSE"],["FALSE"],["FALSE"],["FALSE"],["FALSE"],["FALSE"],["FALSE"],["FALSE"]];try{await this.updateSheetValues({range:a,values:n})}catch(e){throw console.log("Schedule cleaning is unsuccessfull !"),e}}async getInstructorsChatIdsWithNoScheduleResponse(){const e=(await this.getSheetValues({range:`${this.sheetCollection.getSheetName("instructors_availability")}!${r.noResponseInstructorsColumn}2:${r.noResponseInstructorsColumn}1000`})).flat(),t=await this.usersCollection.getAllDocumentValues("fullNames"),s=[];for(let a=0;a<e.length;a++){const n=e[a];for(const e in t){const a=t[e];a===n&&s.push({fullName:a,chatId:Number(e)})}}return s}}t.default=u},9634:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2291)),r=s(8399),o=a(s(9509)),i=s(9785);class u extends n.default{constructor(){super()}async setAllDaysUnworkable(){const e=r.fullScheduleByDayLetters[i.DayNames.monday],t=r.fullScheduleByDayLetters[i.DayNames.sunday];await this.updateSheetValues({range:`${this.sheetCollection.getSheetName(this.renderedSheetName)}!${e}2:${t}2`,values:[["FALSE"],["FALSE"],["FALSE"],["FALSE"],["FALSE"],["FALSE"],["FALSE"]]})}async getOneDaySchedule(e){const t=r.fullScheduleByDayLetters[e],s=`${this.sheetCollection.getSheetName(this.renderedSheetName)}!${t}3:${t}100`;return await this.getSheetValues({range:s})}async getNextDayFullSchedule(){return this.getOneDaySchedule(o.default.nextDayName)}async getNextWeekWorkableDaysSchedule(){const e=await this.getWorkableDaysNumbers(),t=r.fullScheduleByDayLetters[i.DayNames.monday],s=r.fullScheduleByDayLetters[i.DayNames.sunday],a=await this.getSheetValues({range:`${this.sheetCollection.getSheetName(this.renderedSheetName)}!${t}3:${s}20`}),n=[];for(let t=0;t<e.length;t++){const s=e[t];n.push([]);for(let e=0;e<a.length;e++){const r=a[e],o=[];void 0!==r[s]&&o.push(r[s]),n[t].push(o)}}return n}async getWorkableDaysNumbers(){const e=r.fullScheduleByDayLetters[i.DayNames.monday],t=r.fullScheduleByDayLetters[i.DayNames.sunday],s=await this.getSheetValues({range:`${this.sheetCollection.getSheetName(this.renderedSheetName)}!${e}2:${t}2`}),a=[];return s[0].forEach(((e,t)=>{"TRUE"===e&&a.push(t)})),a}async isDayWorkable(e){const t=r.fullScheduleByDayLetters[e];return"FALSE"!==(await this.getSheetValues({range:`${this.sheetCollection.getSheetName(this.renderedSheetName)}!${t}2`}))[0][0]}async isNextDayWorkable(){return await this.isDayWorkable(o.default.nextDayName)}async isTodayWorkable(){return await this.isDayWorkable(o.default.today)}async getInstructorsByBase(e){const t=r.baseInstructorsByLetters[e];return await this.getSheetValues({range:`${this.sheetCollection.getSheetName(this.instructorsByBaseSheetName)}!${t.blood}3:${t.evacuation}100`})}async getTomorrowInstructorsByBase(){const e=await this.getInstructorsByBase(o.default.nextDayName);return this.prepareInstructorsByBase(e)}async getTodayInstructors(){if(!await this.isTodayWorkable())return[];const e=await this.getInstructorsByBase(o.default.today);return[...new Set(e[0])].filter((e=>"#N/A"!==e))}prepareInstructorsByBase(e){const t={blood:[],lungs:[],heart:[],evacuation:[]},s={0:"blood",1:"lungs",2:"heart",3:"evacuation"},a=[];for(let n=0;n<e.length;n++){const r=e[n];for(let e=0;e<r.length;e++){const n=r[e];""!==n&&"#N/A"!==n&&(a.includes(n)||a.push(n),t[s[e]].push(n))}}const n=this.getInstructorsIdsByNames(a),r={blood:[],lungs:[],heart:[],evacuation:[]};for(const e in t)for(let s=0;s<t[e].length;s++){const a=t[e][s];for(let t=0;t<n.length;t++){const s=n[t];a===s.name&&r[e].push(s)}}return r}}t.default=u},2447:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(9634));class r extends n.default{constructor(){super(),this.renderedSheetName="schedule_rendered",this.instructorsByBaseSheetName="instructors_by_bases_schedule"}}t.default=r},2232:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(9634));class r extends n.default{constructor(){super(),this.instructorsByBaseSheetName="intstructors_by_bases_trip_schedule",this.renderedSheetName="schedule_trip_rendered"}}t.default=r},15:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(9326)),r=s(5908),o=a(s(694));class i extends n.default{constructor(e){super(e)}async fillNewSheetWithDatesAndInstructorNames(e){const t=[];for(let s=1;s<e;s++)t.push([`${s}/${(0,r.format)(new Date,"MM")}`]);const s=Object.values(o.default.getInstance().getAllDocumentValues("fullNames")).map((e=>[e]));try{await this.updateSheetValues({values:s,range:"A2",majorDimension:"ROWS"}).then((()=>{console.log("Accounting spreadsheet filled with raw data")})),await this.updateSheetValues({values:t,range:"B1"}).then((()=>{console.log("Accounting spreadsheet filled with raw data")}))}catch(e){throw console.log("Accounting spreadsheet fill unsuccessful, abort !"),e}}async writeTomorrowInstructorsToSpreadsheet(e){const t=Number((0,r.format)(new Date,"D"))+2,s=[],a=this.getColumnLetter(t);for(let t=0;t<e.length;t++){const a=await this.getUserRowIndexInSheet(e[t]);null!==a&&s.push(a)}const n=Math.max(...s),o=Array.from({length:n},(()=>[]));s.forEach((e=>o[e-1].push(1))),await this.updateSheetValues({range:`${a}:${a}`,values:o,majorDimension:"ROWS"}).then((()=>console.log("Accounting info was sent.")))}async getUserRowIndexInSheet(e){const t=await this.getSheetValues({range:"!A:A"});let s=null;for(let a=0;a<t.length;a++)if(e===t[a][0]){s=a+1;break}return s}getColumnLetter(e){let t="";for(;e>0;){const s=(e-1)%26;t=String.fromCharCode(65+s)+t,e=Math.floor((e-1)/26)}return t}}t.default=i},839:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(9993),r=a(s(5062));t.default=class{constructor(){this.drive=n.google.drive({version:"v3",auth:r.default.authenticationObject})}}},9326:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(9993),r=a(s(5062));t.default=class{constructor(e){this.spreadsheetId=e,this.spreadsheet=n.google.sheets({version:"v4",auth:r.default.authenticationObject}),this.values=this.spreadsheet.spreadsheets.values}async getSheetValues({range:e}){const t=(await this.values.get({spreadsheetId:this.spreadsheetId,range:e})).data.values;return null==t?(console.log("No value found in sheets"),[[]]):t}async updateSheetValues(e){const t=e.valueInputOption||"USER_ENTERED",s=e.majorDimension||"COLUMNS";return await this.values.update({spreadsheetId:this.spreadsheetId,range:e.range,valueInputOption:t,requestBody:{range:e.range,majorDimension:s,values:e.values}})}}},9509:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(9785);class n{static get dayNames(){return[a.DayNames.sunday,a.DayNames.monday,a.DayNames.tuesday,a.DayNames.wednesday,a.DayNames.thursday,a.DayNames.friday,a.DayNames.saturday]}static getMonthNames(){return[a.MonthNames.january,a.MonthNames.february,a.MonthNames.march,a.MonthNames.april,a.MonthNames.may,a.MonthNames.june,a.MonthNames.july,a.MonthNames.august,a.MonthNames.september,a.MonthNames.october,a.MonthNames.november,a.MonthNames.december]}static get nextDayName(){let e=(new Date).getDay()+1;return e>6&&(e=0),n.dayNames[e]}static get today(){const e=(new Date).getDay();return n.dayNames[e]}static getDayByNumber(e){const t=n.dayNames,s=e+1;return s>7?t[1]:s>6?t[0]:t[s]}static get currentDayName(){return n.dayNames[(new Date).getDay()]}}t.default=n},8971:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{static get serviceAccountCredentials(){const e=process.env.SERVICE_ACCOUNT_PRIVATE_KEY.replaceAll("\\n","\n");return{type:process.env.SERVICE_ACCOUNT_TYPE,project_id:process.env.SERVICE_ACCOUNT_PROJECT_ID,private_key_id:process.env.SERVICE_ACCOUNT_PRIVATE_KEY_ID,private_key:e,client_email:process.env.SERVICE_ACCOUNT_CLIENT_EMAIL,client_id:process.env.SERVICE_ACCOUNT_CLIENT_ID,auth_uri:process.env.SERVICE_ACCOUNT_AUTH_URI,token_uri:process.env.SERVICE_ACCOUNT_TOKEN_URI,auth_provider_x509_cert_url:process.env.SERVICE_ACCOUNT_AUTH_PROVIDER_CERT_URL,client_x509_cert_url:process.env.SERVICE_ACCOUNT_CLIENT_CERT_URL}}}},341:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5155)),r=s(6604),o=s(9785),{text:i,callback_query:u,command:l,animation:d,audio:c,document:h,photo:_,sticker:p,video:f,video_note:m,voice:g,edited_message:y,location:S}=r.PRIVATE_UPDATE_TYPES,v=[i,u,l,d,c,h,_,p,f,m,g,y,S],M=[o.CMD_NAMES.SCHEDULE,o.CMD_NAMES.COMMANDS_INFO,o.CMD_NAMES.START,o.CMD_NAMES.SAVE_PHOTO,o.CMD_NAMES.SEND_TIMING];new n.default(v,M).init().then((()=>{console.log("Successful APPLICATION start")})).catch((e=>{console.log(e)}))},2833:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(832);t.default=class{constructor(e){this.tg=new a.Telegram(process.env.TELEGRAM_BOT_TOKEN),this.targetId=e}async sendMessage(e){return await this.tg.sendMessage(this.targetId,e)}}},6438:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(6022)),r=a(s(5948)),o=a(s(4530));t.default=class{initSpreadsheetRequestHandlers(e){[n.default,r.default,o.default].forEach((t=>{const s=new t;e.registerObserver(s)}))}}},6022:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2138)),r=s(2224),o=a(s(2447)),i=s(832),u=s(9889),l=a(s(2232)),d=a(s(2387));class c extends n.default{constructor(){super(),this.requestsNames=[r.SPREADSHEET_REQUESTS.send_full_schedule_to_tg_channel],this.centerRenderedScheduleSheet=new o.default,this.tripRenderedScheduleSheet=new l.default,this.tg=new i.Telegram(process.env.TELEGRAM_BOT_TOKEN)}async onUpdate(){const e=await this.sendFullScheduleToTgChannel();d.default.getInstance().updateScheduleMessagesIdsAndAllowEdit(e)}async sendFullScheduleToTgChannel(){return{fullScheduleCenterMsg:await this.sendCenterScheduleToChannel(),fullScheduleTripsMsg:await this.sendTripsScheduleToChannel()}}async sendCenterScheduleToChannel(){const e=await this.centerRenderedScheduleSheet.getNextWeekWorkableDaysSchedule();if(e.length)return this.sendScheduleMessage(e,"–¶–ï–ù–¢–†")}async sendTripsScheduleToChannel(){const e=await this.tripRenderedScheduleSheet.getNextWeekWorkableDaysSchedule();if(e.length)return this.sendScheduleMessage(e,"–í–ò–á–ó–î–ò")}async sendScheduleMessage(e,t){const s=(0,u.renderFullWorkableDaysSchedule)(e,t);if(""!==s)try{return this.tg.sendMessage(process.env.TELEGRAM_CHANNEL_ID,s)}catch(e){console.log("Error on sending everyday schedule to channel",e)}else console.log("Empty full schedule",t)}}t.default=c},5948:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(4843)),r=s(2224),o=a(s(2447));class i extends n.default{constructor(){super(),this.header="–¶–ï–ù–¢–†",this.requestsNames=[r.SPREADSHEET_REQUESTS.update_center_schedule_in_tg_channel],this.renderedScheduleSheet=new o.default}getFullScheduleMsgId(){return this.scheduleUpdateCollection.getCenterFullScheduleMsgId()}}t.default=i},4530:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(4843)),r=s(2224),o=a(s(2232));class i extends n.default{constructor(){super(),this.header="–í–ò–á–ó–î–ò",this.requestsNames=[r.SPREADSHEET_REQUESTS.update_trips_schedule_in_tg_channel],this.renderedScheduleSheet=new o.default}getFullScheduleMsgId(){return this.scheduleUpdateCollection.getTripFullScheduleMsgId()}}t.default=i},4843:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2138)),r=a(s(2387)),o=s(832),i=s(9889),u=a(s(9509));class l extends n.default{constructor(){super(),this.scheduleUpdateCollection=r.default.getInstance(),this.tg=new o.Telegram(process.env.TELEGRAM_BOT_TOKEN),this.header="",this.requestsNames=[]}onUpdate(e){!1!==this.scheduleUpdateCollection.isUpdateAvailable&&this.updateSchedule()}updateSchedule(){this.updateFullSchedule(),this.updateScheduleByDays()}async updateFullSchedule(){const e=this.getFullScheduleMsgId();if(0===e)return;const t=await this.renderedScheduleSheet.getNextWeekWorkableDaysSchedule(),s=(0,i.renderFullWorkableDaysSchedule)(t,this.header);try{await this.tg.editMessageText(process.env.TELEGRAM_CHANNEL_ID,e,void 0,s)}catch(e){console.log(e)}}async updateScheduleByDays(){const e=u.default.dayNames,t=[];e.forEach((e=>{const s=this.scheduleUpdateCollection.getTripOneDayScheduleMsgId(e);0!==s&&t.push({messageId:s,dayName:e})}));for(const{messageId:e,dayName:s}of t){const t=await this.renderedScheduleSheet.getOneDaySchedule(s),a=(0,i.renderOneDayScheduleFromSheet)(t,this.header);try{await this.tg.editMessageText(process.env.TELEGRAM_CHANNEL_ID,e,void 0,a)}catch(e){console.log(e)}}}}t.default=l},2138:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.requestsNames=[]}}},7474:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.requestObservers={}}createRequestObserversArr(e){this.requestObservers[e]=[]}registerObserver(e){e.requestsNames.forEach((t=>{void 0===this.requestObservers[t]&&this.createRequestObserversArr(t);const s=this.requestObservers[t];s.includes(e)?console.warn("This observer already registered"):s.push(e)}))}removeObserver(e){e.requestsNames.forEach((t=>{const s=this.requestObservers[t];s.includes(e)?s.splice(s.indexOf(e),1):console.warn("No such observer you are trying to delete")}))}notifyObservers(e,t){void 0!==this.requestObservers[e]&&this.requestObservers[e].forEach((e=>e.onUpdate(t)))}}},2224:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.SPREADSHEET_REQUESTS=void 0,(s=t.SPREADSHEET_REQUESTS||(t.SPREADSHEET_REQUESTS={})).send_full_schedule_to_tg_channel="send_full_schedule_to_telegram_channel",s.update_trips_schedule_in_tg_channel="update_trips_schedule_in_tg_channel",s.update_center_schedule_in_tg_channel="update_center_schedule_in_tg_channel"},7750:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.commandsDescription=void 0;const a=s(9785),n={schedule:{command:a.CMD_NAMES.SCHEDULE,description:"–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ä–æ–∑–∫–ª–∞–¥."},info:{command:a.CMD_NAMES.COMMANDS_INFO,description:"–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø–æ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∫–æ–º–∞–Ω–¥–∞—Ö –±–æ—Ç–∞."},start:{command:a.CMD_NAMES.START,description:"–°—Ç–∞—Ä—Ç —Ä–æ–±–æ—Ç–∏ –∑ –±–æ—Ç–æ–º."},savephotos:{command:a.CMD_NAMES.SAVE_PHOTO,description:"–ó–±–µ—Ä—ñ–≥—Ç–∏ —Ñ–æ—Ç–æ –Ω–∞ –≥—É–≥–ª –¥–∏—Å–∫—É."},sendtiming:{command:a.CMD_NAMES.SEND_TIMING,description:"–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ç–∞–π–º—ñ–Ω–≥ —É ICTM —ñ–Ω—Ñ–æ."}};t.commandsDescription=n},8924:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(1083));t.default=class{constructor(e){this.name=e,this.driveService=new n.default(this.name)}async writeInstructorsToAccountingSheet(){const e=await this.sortInstructors();await this.driveService.writeTomorrowInstructorsToAccountingSheet(e)}async sortInstructors(){const e=await this.renderedScheduleSheet.getTomorrowInstructorsByBase(),t=[];for(const s in e){const a=e[s];for(let e=0;e<a.length;e++){const{name:s}=a[e];t.includes(s)||t.push(s)}}return t}}},6016:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(8924)),r=a(s(2447));class o extends n.default{constructor(){super("–¶–µ–Ω—Ç—Ä –∑–≤—ñ—Ç–Ω—ñ—Å—Ç—å "),this.renderedScheduleSheet=new r.default}}t.default=o},5520:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(8924)),r=a(s(2232));class o extends n.default{constructor(){super("–í–∏—ó–∑–¥ –∑–≤—ñ—Ç–Ω—ñ—Å—Ç—å "),this.renderedScheduleSheet=new r.default}}t.default=o},5164:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(6604),r=a(s(9438)),o=a(s(1295));class i extends r.default{constructor(e,t){super(e),this.receiveCommands=t,this.contextDecoratorCreator=new o.default}subscribeForBotUpdates(e){this.subscribeForCommands(e),this.subscribeForMessages(e)}subscribeForCommands(e){this.receiveCommands.forEach((t=>{e.command(t,(e=>{this.onUpdate(n.PRIVATE_UPDATE_TYPES.command,e)}))}))}onUpdate(e,t){if("private"!==t.chat?.type)return;const s=this.contextDecoratorCreator.createDecorator(e,t);null!==s&&this.notifyObservers(s)}}t.default=i},9438:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(2998));class r extends n.default{constructor(e){super(),this.receiveMessagesTypes=e}subscribeForBotUpdates(e){this.subscribeForMessages(e)}subscribeForMessages(e){this.receiveMessagesTypes.forEach((t=>{"command"!==t&&e.on(t,(e=>{this.onUpdate(t,e)}))}))}}t.default=r},5959:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{}},1295:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(5959)),r=s(4317),o=a(s(873));class i extends n.default{constructor(){super(...arguments),this.updateScope=r.UPDATE_SCOPES.PRIVATE,this.payloadCreator=new o.default}createDecorator(e,t){const s=this.payloadCreator.create(e,t);return null===s?null:{payload:s,messagePayloadType:s.type,updateType:e,updateScope:this.updateScope,context:t}}}t.default=i},7838:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(6604);t.default=class{static getMessageField(e){return e.update.message}static getUpdateMessageType(e){for(const t in a.MESSAGES_TYPES)if(Object.prototype.hasOwnProperty.call(e,t))return t;return a.MESSAGES_TYPES.none}static getContextUpdateType(e){for(const t in a.UPDATE_TYPES)if(Object.prototype.hasOwnProperty.call(e,t))return t;return a.UPDATE_TYPES.unknown}}},2998:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.observers=[]}registerObserver(e){this.observers.includes(e)?console.warn("This observer already registered"):this.observers.push(e)}removeObserver(e){this.observers.includes(e)?this.observers.splice(this.observers.indexOf(e),1):console.warn("No such observer you are trying to delete")}notifyObservers(e){this.observers.forEach((t=>{t.onUpdate(e)}))}}},873:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(6604),r=s(2496),o=a(s(7838)),i=a(s(1820));class u extends i.default{constructor(){super(...arguments),this.decoratorCreatorFunctionByUpdateType={[n.PRIVATE_UPDATE_TYPES.text]:this.onText.bind(this),[n.PRIVATE_UPDATE_TYPES.callback_query]:this.onCallbackQuery.bind(this),[n.PRIVATE_UPDATE_TYPES.command]:this.onCommand.bind(this),[n.PRIVATE_UPDATE_TYPES.animation]:this.onAnimation.bind(this),[n.PRIVATE_UPDATE_TYPES.audio]:this.onAudio.bind(this),[n.PRIVATE_UPDATE_TYPES.document]:this.onDocument.bind(this),[n.PRIVATE_UPDATE_TYPES.photo]:this.onPhoto.bind(this),[n.PRIVATE_UPDATE_TYPES.sticker]:this.onSticker.bind(this),[n.PRIVATE_UPDATE_TYPES.video]:this.onVideo.bind(this),[n.PRIVATE_UPDATE_TYPES.video_note]:this.onVideoNote.bind(this),[n.PRIVATE_UPDATE_TYPES.voice]:this.onVoice.bind(this),[n.PRIVATE_UPDATE_TYPES.edited_message]:this.onEditedMessage.bind(this),[n.PRIVATE_UPDATE_TYPES.location]:this.onLocation.bind(this)}}create(e,t){const s=this.decoratorCreatorFunctionByUpdateType[e];return void 0===s?(console.log(`Creation of this kind of payload (${e}) not yet supported`),null):s(t)||null}getDefaultMediaValuesFromMsg(e){return{caption:e.caption,caption_entities:e.caption_entities,media_group_id:e.media_group_id}}getDefaultPayload(e,t,s){const a=o.default.getContextUpdateType(e.update);let r=n.MESSAGES_TYPES.none;if(a===n.UPDATE_TYPES.unknown)throw new Error("UPDATE TYPE UNKNOWN !!!");return a===n.UPDATE_TYPES.message&&(r=o.default.getUpdateMessageType(e.message)),{senderId:s.id,chatId:s.id,updateType:a,messageType:r,type:t}}onText(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,r.PAYLOAD_TYPES.text,t.from),text:t.text,entities:t.entities}}onCallbackQuery(e){const t=e.update,s=this.getDefaultPayload(e,r.PAYLOAD_TYPES.callback_query,t.callback_query.from),a=t.callback_query.message;return{...s,callback_query:t.callback_query,messageId:a.message_id}}onCommand(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,r.PAYLOAD_TYPES.command,t.from),command:t.text.slice(1)}}onAnimation(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,r.PAYLOAD_TYPES.animation,t.from),animation:t.animation,document:t.document}}onAudio(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,r.PAYLOAD_TYPES.audio,t.from),audio:t.audio,...this.getDefaultMediaValuesFromMsg(t)}}onDocument(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,r.PAYLOAD_TYPES.document,t.from),document:t.document,...this.getDefaultMediaValuesFromMsg(t)}}onPhoto(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,r.PAYLOAD_TYPES.photo,t.from),photo:t.photo,...this.getDefaultMediaValuesFromMsg(t)}}onSticker(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,r.PAYLOAD_TYPES.sticker,t.from),sticker:t.sticker}}onVideo(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,r.PAYLOAD_TYPES.video,t.from),video:t.video,...this.getDefaultMediaValuesFromMsg(t)}}onVideoNote(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,r.PAYLOAD_TYPES.video_note,t.from),video_note:t.video_note}}onVoice(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,r.PAYLOAD_TYPES.voice,t.from),voice:t.voice,caption:t.caption}}onEditedMessage(e){const t=e.update;return{...this.getDefaultPayload(e,r.PAYLOAD_TYPES.edited_message,t.edited_message.from),edited_message:t,edited_message_type:o.default.getUpdateMessageType(t.edited_message)}}onLocation(e){const t=o.default.getMessageField(e);return{...this.getDefaultPayload(e,r.PAYLOAD_TYPES.voice,t.from),location:t.location}}}t.default=u},1820:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{onText(e){}onCallbackQuery(e){}onCommand(e){}onAnimation(e){}onAudio(e){}onDocument(e){}onPhoto(e){}onSticker(e){}onVideo(e){}onVideoNote(e){}onVoice(e){}onEditedMessage(e){}onLocation(e){}}},4317:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.UPDATE_SCOPES=void 0,function(e){e.CHANNEL="channel_scope",e.CHAT="chat_scope",e.PRIVATE="private_scope"}(s||(s={})),t.UPDATE_SCOPES=s},6604:(e,t)=>{var s,a,n,r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.UPDATE_TYPES=t.MESSAGES_TYPES=t.CHAT_UPDATE_TYPES=t.CHANNEL_UPDATE_TYPES=t.PRIVATE_UPDATE_TYPES=void 0,function(e){e.text="text",e.audio="audio",e.document="document",e.animation="animation",e.photo="photo",e.sticker="sticker",e.video="video",e.video_note="video_note",e.voice="voice",e.contact="contact",e.dice="dice",e.game="game",e.poll="poll",e.location="location",e.venue="venue",e.new_chat_members="new_chat_members",e.left_chat_member="left_chat_member",e.new_chat_title="new_chat_title",e.new_chat_photo="new_chat_photo",e.delete_chat_photo="delete_chat_photo",e.group_chat_created="group_chat_created",e.supergroup_chat_created="supergroup_chat_created",e.channel_chat_created="channel_chat_created",e.message_auto_delete_timer_changed="message_auto_delete_timer_changed",e.migrate_to_chat_id="migrate_to_chat_id",e.migrate_from_chat_id="migrate_from_chat_id",e.pinned_message="pinned_message",e.invoice="invoice",e.successful_payment="successful_payment",e.connected_website="connected_website",e.passport_data="passport_data",e.proximity_alert_triggered="proximity_alert_triggered",e.forum_topic_created="forum_topic_created",e.forum_topic_closed="forum_topic_closed",e.forum_topic_reopened="forum_topic_reopened",e.video_chat_scheduled="video_chat_scheduled",e.video_chat_started="video_chat_started",e.video_chat_ended="video_chat_ended",e.video_chat_participants_invited="video_chat_participants_invited",e.web_app_data="web_app_data",e.none="none"}(s||(s={})),t.MESSAGES_TYPES=s,function(e){e.message="message",e.edited_message="edited_message",e.channel_post="channel_post",e.edited_channel_post="edited_channel_post",e.inline_query="inline_query",e.chosen_inline_result="chosen_inline_result",e.callback_query="callback_query",e.shipping_query="shipping_query",e.pre_checkout_query="pre_checkout_query",e.poll="poll",e.poll_answer="poll_answer",e.my_chat_member="my_chat_member",e.chat_member="chat_member",e.chat_join_request="chat_join_request",e.unknown="unknown"}(a||(a={})),t.UPDATE_TYPES=a,function(e){e.text="text",e.callback_query="callback_query",e.command="command",e.animation="animation",e.audio="audio",e.document="document",e.photo="photo",e.sticker="sticker",e.video="video",e.video_note="video_note",e.voice="voice",e.edited_message="edited_message",e.location="location"}(n||(n={})),t.PRIVATE_UPDATE_TYPES=n,function(e){e.channel_post="channel_post"}(r||(r={})),t.CHANNEL_UPDATE_TYPES=r,function(e){e.new_chat_photo="new_chat_photo",e.command="command"}(o||(o={})),t.CHAT_UPDATE_TYPES=o},2496:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.PAYLOAD_TYPES=void 0,(s=t.PAYLOAD_TYPES||(t.PAYLOAD_TYPES={})).audio="audio_payload_type",s.text="text_payload_type",s.callback_query="callback_query_payload_type",s.command="command_type",s.animation="animation_type",s.document="document_type",s.photo="photo_type",s.sticker="sticker_type",s.video="video_type",s.video_note="video_note_type",s.voice="voice_type",s.edited_message="edited_message_type"},881:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this._accessible=!1}setUnAccessible(){this.accessible=!1}setAccessible(){this.accessible=!0}get accessible(){return this._accessible}set accessible(e){this._accessible=e}}},9785:(e,t)=>{var s,a,n;Object.defineProperty(t,"__esModule",{value:!0}),t.MonthNames=t.DayNames=t.CMD_NAMES=void 0,(n=t.CMD_NAMES||(t.CMD_NAMES={})).SCHEDULE="schedule",n.COMMANDS_INFO="commandsinfo",n.NONE="none",n.START="start",n.SAVE_PHOTO="savephotos",n.SEND_TIMING="sendtiming",(a=t.DayNames||(t.DayNames={})).sunday="Sunday",a.monday="Monday",a.tuesday="Tuesday",a.wednesday="Wednesday",a.thursday="Thursday",a.friday="Friday",a.saturday="Saturday",(s=t.MonthNames||(t.MonthNames={})).january="—Å—ñ—á–µ–Ω—å",s.february="–ª—é—Ç–∏–π",s.march="–±–µ—Ä–µ–∑–µ–Ω—å",s.april="–∫–≤—ñ—Ç–µ–Ω—å",s.may="—Ç—Ä–∞–≤–µ–Ω—å",s.june="—á–µ—Ä–≤–µ–Ω—å",s.july="–ª–∏–ø–µ–Ω—å",s.august="—Å–µ—Ä–ø–µ–Ω—å",s.september="–≤–µ—Ä–µ—Å–µ–Ω—å",s.october="–∂–æ–≤—Ç–µ–Ω—å",s.november="–ª–∏—Å—Ç–æ–ø–∞–¥",s.december="–≥—Ä—É–¥–µ–Ω—å"},946:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(7358));t.default=class{constructor(){this.users={}}getUserById(e){let t=this.users[e];return void 0===t&&(t=this.createUserScope(e)),t}createUserScope(e){const t=new n.default(e);return this.users[e]=t,t}onUpdate(e){this.getUserById(e.payload.senderId).onUpdate(e)}}},7358:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(9119));t.default=class{constructor(e){this.id=e,this.strategy=new n.default(e)}onUpdate(e){this.strategy.onUpdate(e)}}},9119:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(s(6481)),r=a(s(5638)),o=a(s(495)),i=a(s(2885)),u=a(s(8245)),l=a(s(4606)),d=a(s(8326));class c extends n.default{constructor(e){super(),this.cmdHandlerManager=new r.default(e,[o.default,i.default,u.default,l.default,d.default])}onUpdate(e){this.cmdHandlerManager.onUpdate(e)}}t.default=c},6481:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{}},3986:e=>{e.exports=require("body-parser")},3582:e=>{e.exports=require("cors")},5142:e=>{e.exports=require("dotenv")},5502:e=>{e.exports=require("eventemitter3")},6860:e=>{e.exports=require("express")},325:e=>{e.exports=require("firebase-admin/app")},2594:e=>{e.exports=require("firebase-admin/firestore")},6781:e=>{e.exports=require("google-auth-library")},9993:e=>{e.exports=require("googleapis")},2748:e=>{e.exports=require("luxon")},8311:e=>{e.exports=require("node-cron")},832:e=>{e.exports=require("telegraf")},5908:e=>{e.exports=require("ts-date")},5687:e=>{e.exports=require("https")},2781:e=>{e.exports=require("stream")}},t={};!function s(a){var n=t[a];if(void 0!==n)return n.exports;var r=t[a]={exports:{}};return e[a].call(r.exports,r,r.exports,s),r.exports}(341)})();